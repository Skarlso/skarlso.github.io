<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Furnace - The building of an AWS CLI Tool for CloudFormation and CodeDeploy - Part 3 :: Ramblings of a cloud engineer</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Intro Hi folks.
Previously on this blog: Part 1. Part 2. Part 4.
In this part, I&amp;rsquo;m going to talk about the experimental plugin system of Furnace.
Go Experimental Plugins Since Go 1.8 was released, an exciting and new feature was introduced called a Plug-in system. This system works with dynamic libraries built with a special switch to go build. These libraries, .so or .dylib (later), are than loaded and once that succeeds, specific functions can be called from them (symbol resolution)."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://skarlso.github.io/2017/03/22/building-furnace-part-3/" />


<link rel="stylesheet" href="https://skarlso.github.io/assets/style.css">

  <link rel="stylesheet" href="https://skarlso.github.io/assets/green.css">



<link rel="stylesheet" href="https://skarlso.github.io/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://skarlso.github.io/img/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="https://skarlso.github.io/img/favicon/green.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Furnace - The building of an AWS CLI Tool for CloudFormation and CodeDeploy - Part 3 :: Ramblings of a cloud engineer — " />
<meta name="twitter:description" content="Intro Hi folks.
Previously on this blog: Part 1. Part 2. Part 4.
In this part, I&amp;rsquo;m going to talk about the experimental plugin system of Furnace.
Go Experimental Plugins Since Go 1.8 was released, an exciting and new feature was introduced called a Plug-in system. This system works with dynamic libraries built with a special switch to go build. These libraries, .so or .dylib (later), are than loaded and once that succeeds, specific functions can be called from them (symbol resolution)." />
<meta name="twitter:site" content="https://skarlso.github.io/" />
<meta name="twitter:creator" content="hannibal" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Furnace - The building of an AWS CLI Tool for CloudFormation and CodeDeploy - Part 3 :: Ramblings of a cloud engineer — ">
<meta property="og:description" content="Intro Hi folks.
Previously on this blog: Part 1. Part 2. Part 4.
In this part, I&amp;rsquo;m going to talk about the experimental plugin system of Furnace.
Go Experimental Plugins Since Go 1.8 was released, an exciting and new feature was introduced called a Plug-in system. This system works with dynamic libraries built with a special switch to go build. These libraries, .so or .dylib (later), are than loaded and once that succeeds, specific functions can be called from them (symbol resolution)." />
<meta property="og:url" content="https://skarlso.github.io/2017/03/22/building-furnace-part-3/" />
<meta property="og:site_name" content="Furnace - The building of an AWS CLI Tool for CloudFormation and CodeDeploy - Part 3" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:section" content="Golang" /><meta property="article:section" content="AWS" />
<meta property="article:published_time" content="2017-03-22 12:03:00 &#43;0100 &#43;0100" />







</head>
<body class="">
<div class="container">
  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://skarlso.github.io/">
  <div class="logo">
    Terminal
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="https://skarlso.github.io/">Home</a></li>
        
      
        
          <li><a href="https://skarlso.github.io/blog/">Blog</a></li>
        
      
        
          <li><a href="https://skarlso.github.io/categories/">Categories</a></li>
        
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="https://skarlso.github.io/">Home</a></li>
      
    
      
        <li><a href="https://skarlso.github.io/blog/">Blog</a></li>
      
    
      
        <li><a href="https://skarlso.github.io/categories/">Categories</a></li>
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
  <div class="post">
    <h1 class="post-title"><a href="https://skarlso.github.io/2017/03/22/building-furnace-part-3/">Furnace - The building of an AWS CLI Tool for CloudFormation and CodeDeploy - Part 3</a></h1>
    <div class="post-meta">
      <span class="post-date">
        2017-03-22
      </span>
      <span class="post-author">:: hannibal</span>
    </div>

    

    

    <div class="post-content">
      

<h1 id="intro">Intro</h1>

<p>Hi folks.</p>

<p>Previously on this blog: <a href="http://skarlso.github.io/2017/03/16/building-furnace-part-1/">Part 1</a>. <a href="https://skarlso.github.io/2017/03/19/building-furnace-part-2/">Part 2</a>. <a href="https://skarlso.github.io/2017/04/16/building-furnace-part-4/">Part 4</a>.</p>

<p>In this part, I&rsquo;m going to talk about the experimental plugin system of Furnace.</p>

<h1 id="go-experimental-plugins">Go Experimental Plugins</h1>

<p>Since Go 1.8 was released, an exciting and new feature was introduced called a Plug-in system. This system works with dynamic
libraries built with a special switch to <code>go build</code>. These libraries, <code>.so</code> or <code>.dylib</code> (later), are than loaded and once that
succeeds, specific functions can be called from them (symbol resolution).</p>

<p>We will see how this works. For package information, visit the plugin packages Go doc page
<a href="https://tip.golang.org/pkg/plugin/">here</a>.</p>

<h1 id="furnace-plugins">Furnace Plugins</h1>

<p>So, what does furnace use plugins for? Furnace uses plugins to execute arbitery code in, currently, four given locations / events.</p>

<p>These are: <code>pre_create, post_create, pre_delete, post_delete</code>. These events are called, as their name suggests, before and after
the creation and deletion of the CloudFormation stack. It allows the user to execute some code without having to rebuild the whole
project. It does that by defining a single entry point for the custom code called <code>RunPlugin</code>. Any number of functions can be
implemented, but the plugin MUST provide this single, exported function. Otherwise it will fail and ignore that plugin.</p>

<h2 id="using-plugins">Using Plugins</h2>

<p>It&rsquo;s really easy to implement, and use these plugins. I&rsquo;m not going into the detail of how to load them, because that is done by
Furnace, but only how to write and use them.</p>

<p>To use a plugin, create a go file called: <code>0001_mailer.go</code>. The <code>0001</code> before it will define WHEN it&rsquo;s executed.
Having multiple plugins is completely okay. Execution of order however, depends on the names of the files.</p>

<p>Now, in 0001_mailer.post_create we would have something like this:</p>

<pre><code class="language-go">package main

import &quot;log&quot;

// RunPlugin runs the plugin.
func RunPlugin() {
	log.Println(&quot;My Awesome Pre Create Plugin.&quot;)
}
</code></pre>

<p>Next step is the build this file to be a plugin library. Note: Right now, this only works on Linux!</p>

<p>To build this file run the following:</p>

<pre><code>go build -buildmode=plugin -o 0001_mailer.pre_create 0001_mailer.go
</code></pre>

<p>The important part here is the extension of the file specified with <code>-o</code>. It&rsquo;s important because that&rsquo;s how Furnace identifies
what plugins it has to run.</p>

<p>Finally, copy this file to <code>~/.config/go-furnace/plugins</code> and you are all set.</p>

<h2 id="slack-notification-plugin">Slack notification Plugin</h2>

<p>To demonstrate how a plugin could be used is if you need some kind of notification once a Stack is completed. For example, you
might want to send a message to a Slack room. To do this, your plugin would look something like this:</p>

<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;os&quot;

	&quot;github.com/nlopes/slack&quot;
)

func RunPlugin() {
	stackname := os.Getenv(&quot;FURNACE_STACKNAME&quot;)
	api := slack.New(&quot;YOUR_TOKEN_HERE&quot;)
	params := slack.PostMessageParameters{}
	channelID, timestamp, err := api.PostMessage(&quot;#general&quot;, fmt.Sprintf(&quot;Stack with name '%s' is Done.&quot;, stackname), params)
	if err != nil {
		fmt.Printf(&quot;%s\n&quot;, err)
		return
	}
	fmt.Printf(&quot;Message successfully sent to channel %s at %s&quot;, channelID, timestamp)
}
</code></pre>

<p>Currently, Furnace has no ability to share information of the stack with an outside plugin. Thus &lsquo;Done&rsquo; could be anything from
Rollback to Failed to CreateComplete.</p>

<h1 id="closing-words">Closing Words</h1>

<p>That&rsquo;s it for plugins. Thanks very much for reading!
Gergely.</p>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h"></span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://skarlso.github.io/2017/04/16/building-furnace-part-4/">
                <span class="button__icon">←</span>
                <span class="button__text">Furnace - The building of an AWS CLI Tool for CloudFormation and CodeDeploy - Part 4</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://skarlso.github.io/2017/03/19/building-furnace-part-2/">
                <span class="button__text">Furnace - The building of an AWS CLI Tool for CloudFormation and CodeDeploy - Part 2</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    
  </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2019 Powered by <a href="http://gohugo.io">Hugo</a></span>
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="https://skarlso.github.io/assets/main.js"></script>
<script src="https://skarlso.github.io/assets/prism.js"></script>

  
</div>

</body>
</html>
