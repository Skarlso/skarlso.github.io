<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>problem solving &middot; Ramblings of a cloud engineer</title>

    <meta name="description" content="Ramblings of a Cloud Engineer">

    <meta name="generator" content="Hugo 0.54-DEV" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="problem solving &middot; Ramblings of a cloud engineer">
    <meta name="twitter:description" content="Ramblings of a Cloud Engineer">

    <meta property="og:type" content="article">
    <meta property="og:title" content="problem solving &middot; Ramblings of a cloud engineer">
    <meta property="og:description" content="Ramblings of a Cloud Engineer">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

    <link rel="stylesheet" href="https://skarlso.github.io//css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Ramblings of a cloud engineer" href="https://skarlso.github.io//index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://skarlso.github.io/">Ramblings of a cloud engineer</a></h1>
            <h2 class="brand-tagline"> Ramblings of a Cloud Engineer </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://skarlso.github.io//index.xml"><i class="fa fa-rss"></i> rss</a>
                </li></br>
                <div style="box-shadow: 0px 0px 0px 1px #000; overflow-y: scroll; height:250px;" align="left">
                    
                        <a href="https://skarlso.github.io/2015/10/26/kill-a-program-on-connecting-to-a-specific-wifi-osx/">Kill a Program on Connecting to a specific WiFi – OSX</a></br>
                    
                        <a href="https://skarlso.github.io/2015/10/26/kill-a-program-on-connecting-to-a-specific-wifi-osx/">Kill a Program on Connecting to a specific WiFi – OSX</a></br>
                    
                        <a href="https://skarlso.github.io/2015/10/15/circular-buffer-in-go/">Circular buffer in Go</a></br>
                    
                        <a href="https://skarlso.github.io/2015/10/15/circular-buffer-in-go/">Circular buffer in Go</a></br>
                    
                        <a href="https://skarlso.github.io/2015/10/04/datamunger-kata-with-go/">DataMunger Kata with Go</a></br>
                    
                        <a href="https://skarlso.github.io/2015/10/04/datamunger-kata-with-go/">DataMunger Kata with Go</a></br>
                    
                        <a href="https://skarlso.github.io/2015/10/02/how-to-aggregate-tests-with-jenkins-with-aggregate-plugin-on-non-relating-jobs/">How to Aggregate Tests with Jenkins with Aggregate Plugin on non-relating jobs</a></br>
                    
                        <a href="https://skarlso.github.io/2015/10/02/how-to-aggregate-tests-with-jenkins-with-aggregate-plugin-on-non-relating-jobs/">How to Aggregate Tests with Jenkins with Aggregate Plugin on non-relating jobs</a></br>
                    
                        <a href="https://skarlso.github.io/2015/07/30/sieve-of-eratosthenes-in-go/">Sieve of Eratosthenes in Go</a></br>
                    
                        <a href="https://skarlso.github.io/2015/07/30/sieve-of-eratosthenes-in-go/">Sieve of Eratosthenes in Go</a></br>
                    
                        <a href="https://skarlso.github.io/2015/07/22/quick-tip-for-debugging-headless-locally/">Quick Tip for Debugging Headless Locally</a></br>
                    
                        <a href="https://skarlso.github.io/2015/07/22/quick-tip-for-debugging-headless-locally/">Quick Tip for Debugging Headless Locally</a></br>
                    
                        <a href="https://skarlso.github.io/2015/07/19/converting-numbers-into-string-representations/">Converting numbers into string representations</a></br>
                    
                        <a href="https://skarlso.github.io/2015/07/19/converting-numbers-into-string-representations/">Converting numbers into string representations</a></br>
                    
                        <a href="https://skarlso.github.io/2015/07/16/selenium-testing-with-packer-and-vagrant/">Selenium Testing with Packer and Vagrant</a></br>
                    
                        <a href="https://skarlso.github.io/2015/07/16/selenium-testing-with-packer-and-vagrant/">Selenium Testing with Packer and Vagrant</a></br>
                    
                        <a href="https://skarlso.github.io/2015/07/01/packer-0-8-1/">Packer 0.8.1.</a></br>
                    
                        <a href="https://skarlso.github.io/2015/07/01/packer-0-8-1/">Packer 0.8.1.</a></br>
                    
                        <a href="https://skarlso.github.io/2015/06/30/powershell-can-also-be-nice-or-installing-java-silently-and-waiting/">Powershell can also be nice -Or Installing Java silently and waiting</a></br>
                    
                        <a href="https://skarlso.github.io/2015/06/30/powershell-can-also-be-nice-or-installing-java-silently-and-waiting/">Powershell can also be nice -Or Installing Java silently and waiting</a></br>
                    
                        <a href="https://skarlso.github.io/2015/06/27/the-packer-the-windows-and-the-vagrant-box/">The Packer, The Windows, and the Vagrant box</a></br>
                    
                        <a href="https://skarlso.github.io/2015/06/27/the-packer-the-windows-and-the-vagrant-box/">The Packer, The Windows, and the Vagrant box</a></br>
                    
                        <a href="https://skarlso.github.io/2015/02/08/why-lock-picking-is-like-testing/">Why Lock Picking is like Testing</a></br>
                    
                        <a href="https://skarlso.github.io/2015/02/08/why-lock-picking-is-like-testing/">Why Lock Picking is like Testing</a></br>
                    
                        <a href="https://skarlso.github.io/2014/02/19/example-when-to-use-the-strategy-pattern/">Example when to use the Strategy Pattern</a></br>
                    
                        <a href="https://skarlso.github.io/2014/02/19/example-when-to-use-the-strategy-pattern/">Example when to use the Strategy Pattern</a></br>
                    
                        <a href="https://skarlso.github.io/2014/02/11/how-to-check-content-header-on-unknown-number-of-items-python/">How to check content header on unknown number of items – Python</a></br>
                    
                        <a href="https://skarlso.github.io/2014/02/11/how-to-check-content-header-on-unknown-number-of-items-python/">How to check content header on unknown number of items – Python</a></br>
                    
                        <a href="https://skarlso.github.io/2014/02/09/why-does-it-matter-if-i-sit-in-an-office-or-in-a-park/">Why does it matter if I sit in an office or in a park</a></br>
                    
                        <a href="https://skarlso.github.io/2014/02/09/why-does-it-matter-if-i-sit-in-an-office-or-in-a-park/">Why does it matter if I sit in an office or in a park</a></br>
                    
                        <a href="https://skarlso.github.io/2013/06/24/sublime-text-5/">Sublime text</a></br>
                    
                        <a href="https://skarlso.github.io/2013/06/24/sublime-text-5/">Sublime text</a></br>
                    
                        <a href="https://skarlso.github.io/2013/04/18/cucumber-jvm-and-afterall/">Cucumber-Jvm And @AfterAll</a></br>
                    
                        <a href="https://skarlso.github.io/2013/04/18/cucumber-jvm-and-afterall/">Cucumber-Jvm And @AfterAll</a></br>
                    
                        <a href="https://skarlso.github.io/2013/04/15/cucumber-test-name-and-tags-on-feature/">Cucumber Test Name and Tags on Feature</a></br>
                    
                        <a href="https://skarlso.github.io/2013/04/15/cucumber-test-name-and-tags-on-feature/">Cucumber Test Name and Tags on Feature</a></br>
                    
                        <a href="https://skarlso.github.io/2013/01/31/its-all-about-human-interaction/">It’s all about human interaction.</a></br>
                    
                        <a href="https://skarlso.github.io/2013/01/31/its-all-about-human-interaction/">It’s all about human interaction.</a></br>
                    
                        <a href="https://skarlso.github.io/2013/01/04/from-chaos-there-shall-be-order/">From Chaos There Shall Be Order</a></br>
                    
                        <a href="https://skarlso.github.io/2013/01/04/from-chaos-there-shall-be-order/">From Chaos There Shall Be Order</a></br>
                    
                        <a href="https://skarlso.github.io/2012/10/09/how-to-eliminate-a-parameter-boom/">How to eliminate a parameter boom</a></br>
                    
                        <a href="https://skarlso.github.io/2012/10/09/how-to-eliminate-a-parameter-boom/">How to eliminate a parameter boom</a></br>
                    
                        <a href="https://skarlso.github.io/2012/07/12/tdd-and-game-of-life/">TDD and Game of Life</a></br>
                    
                        <a href="https://skarlso.github.io/2012/07/12/tdd-and-game-of-life/">TDD and Game of Life</a></br>
                    
                        <a href="https://skarlso.github.io/2012/06/26/solution-to-wrap-kata/">Solution to Wrap Kata</a></br>
                    
                        <a href="https://skarlso.github.io/2012/06/26/solution-to-wrap-kata/">Solution to Wrap Kata</a></br>
                    
                        <a href="https://skarlso.github.io/2012/03/04/jms-connection-setup-and-framework/">JMS Connection setup and Framework</a></br>
                    
                        <a href="https://skarlso.github.io/2012/03/04/jms-connection-setup-and-framework/">JMS Connection setup and Framework</a></br>
                    
                        <a href="https://skarlso.github.io/2012/02/27/configuration/">Configuration</a></br>
                    
                        <a href="https://skarlso.github.io/2012/02/27/configuration/">Configuration</a></br>
                    
                </div>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">22 Jul 2015, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2015/07/22/quick-tip-for-debugging-headless-locally/" class="post-title">Quick Tip for Debugging Headless Locally</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-problem solving" href="https://skarlso.github.io//categories/problem-solving">problem solving</a><a class="post-category post-category-rambling" href="https://skarlso.github.io//categories/rambling">rambling</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>If you are installing something with Packer and you have Headless enabled(and you are lazy and don&#8217;t want to switch it off), it gets difficult, to see output.</p>

<p>Especially on a windows install the Answer File / Unattended install can be like =&gt; Waiting for SSH&#8230; for about an hour or two! If you are doing this locally fret not. Just start VirtualBox, and watch the Preview section which will display the current state even if it&#8217;s a headless install!</p>

<p>It&#8217;s a small windows, but your can click on <strong>Show</strong> which will open the VM in a proper view.</p>

<p>Enjoy,
Gergely.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">22 Jul 2015, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2015/07/22/quick-tip-for-debugging-headless-locally/" class="post-title">Quick Tip for Debugging Headless Locally</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-problem solving" href="https://skarlso.github.io//categories/problem-solving">problem solving</a><a class="post-category post-category-rambling" href="https://skarlso.github.io//categories/rambling">rambling</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>If you are installing something with Packer and you have Headless enabled(and you are lazy and don&#8217;t want to switch it off), it gets difficult, to see output.</p>

<p>Especially on a windows install the Answer File / Unattended install can be like =&gt; Waiting for SSH&#8230; for about an hour or two! If you are doing this locally fret not. Just start VirtualBox, and watch the Preview section which will display the current state even if it&#8217;s a headless install!</p>

<p>It&#8217;s a small windows, but your can click on <strong>Show</strong> which will open the VM in a proper view.</p>

<p>Enjoy,
Gergely.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">19 Jul 2015, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2015/07/19/converting-numbers-into-string-representations/" class="post-title">Converting numbers into string representations</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-problem solving" href="https://skarlso.github.io//categories/problem-solving">problem solving</a><a class="post-category post-category-programming" href="https://skarlso.github.io//categories/programming">programming</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>I quiet like this one. My first go program snippet without any peaking or googling. I&#8217;m proud, though it could be improved with a bit of struct magic and such and such. And it only counts &#8217;till 1000&#8230;</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="go" style="font-family:monospace;"><span style="color: #b1b100; font-weight: bold;">package</span> main
&nbsp;
<span style="color: #b1b100; font-weight: bold;">import</span> <span style="color: #cc66cc;">"fmt"</span>
&nbsp;
<span style="color: #b1b100; font-weight: bold;">var</span> words <span style="color: #339933;">=</span> <span style="color: #993333;">map</span><span style="color: #339933;">[</span><span style="color: #993333;">int</span><span style="color: #339933;">]</span><span style="color: #993333;">string</span><span style="color: #339933;">{</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"one"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"two"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">3</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"three"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"four"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">5</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"five"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">6</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"six"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">7</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"seven"</span><span style="color: #339933;">,</span>
    <span style="color: #cc66cc;">8</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"eight"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">9</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"nine"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">10</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"ten"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">11</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"eleven"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">12</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"twelve"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">13</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"thirteen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">14</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"fourteen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">15</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"fifteen"</span><span style="color: #339933;">,</span>
    <span style="color: #cc66cc;">16</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"sixteen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">17</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"seventeen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">18</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"eighteen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">19</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"nineteen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">20</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"twenty"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">30</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"thirty"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">40</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"forty"</span><span style="color: #339933;">,</span>
    <span style="color: #cc66cc;">50</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"fifty"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">60</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"sixty"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">70</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"seventy"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">80</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"eighty"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">90</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"ninety"</span><span style="color: #339933;">}</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// CountLetters count the letters in a long string number representation</span>
<span style="color: #993333;">func</span> CountLetters<span style="color: #339933;">(</span>limit <span style="color: #993333;">int</span><span style="color: #339933;">)</span> <span style="color: #339933;">{</span>
    myLongNumberString <span style="color: #339933;">:=</span> <span style="color: #cc66cc;">""</span>
    <span style="color: #b1b100; font-weight: bold;">for</span> <span style="">i</span> <span style="color: #339933;">:=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="">i</span> &lt;<span style="color: #339933;">=</span> limit<span style="color: #339933;">;</span> <span style="">i</span><span style="color: #339933;">++</span> <span style="color: #339933;">{</span>
        addLettersToMyString<span style="color: #339933;">(</span>&myLongNumberString<span style="color: #339933;">,</span> <span style="">i</span><span style="color: #339933;">)</span>
    <span style="color: #339933;">}</span>
    <span style="color: #666666; font-style: italic;">// fmt.Println("1-9 written with letters is: ", len(myLongNumberString))</span>
    fmt<span style="color: #339933;">.</span><span style="">Println</span><span style="color: #339933;">(</span><span style="color: #cc66cc;">"The string is:"</span><span style="color: #339933;">,</span> myLongNumberString<span style="color: #339933;">)</span>
    fmt<span style="color: #339933;">.</span><span style="">Println</span><span style="color: #339933;">(</span><span style="color: #cc66cc;">"Lenght of string is:"</span><span style="color: #339933;">,</span> <span style="color: #000066;">len</span><span style="color: #339933;">(</span>myLongNumberString<span style="color: #339933;">))</span>
<span style="color: #339933;">}</span>
&nbsp;
<span style="color: #993333;">func</span> addLettersToMyString<span style="color: #339933;">(</span>myString <span style="color: #339933;">*</span><span style="color: #993333;">string</span><span style="color: #339933;">,</span> num <span style="color: #993333;">int</span><span style="color: #339933;">)</span> <span style="color: #339933;">{</span>
    <span style="color: #b1b100; font-weight: bold;">if</span> num &lt; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">{</span>
        <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> words<span style="color: #339933;">[</span>num<span style="color: #339933;">]</span>
    <span style="color: #339933;">}</span>
&nbsp;
    <span style="color: #b1b100; font-weight: bold;">if</span> num &gt;<span style="color: #339933;">=</span> <span style="color: #cc66cc;">20</span> && num &lt; <span style="color: #cc66cc;">100</span> <span style="color: #339933;">{</span>
        <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> countMiddle<span style="color: #339933;">(</span>num<span style="color: #339933;">)</span>
    <span style="color: #339933;">}</span>
&nbsp;
    <span style="color: #b1b100; font-weight: bold;">if</span> num &gt;<span style="color: #339933;">=</span> <span style="color: #cc66cc;">100</span> && num &lt; <span style="color: #cc66cc;">1000</span> <span style="color: #339933;">{</span>
        hundred<span style="color: #339933;">,</span> tenth <span style="color: #339933;">:=</span> countHundred<span style="color: #339933;">(</span>num<span style="color: #339933;">)</span>
        <span style="color: #b1b100; font-weight: bold;">if</span> tenth <span style="color: #339933;">==</span> <span style="color: #cc66cc;"></span> <span style="color: #339933;">{</span>
            <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> hundred
        <span style="color: #339933;">}</span> <span style="color: #b1b100; font-weight: bold;">else</span> <span style="color: #b1b100; font-weight: bold;">if</span> tenth &gt;<span style="color: #339933;">=</span> <span style="color: #cc66cc;">11</span> && tenth &lt; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">{</span>
            <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> hundred <span style="color: #339933;">+</span> <span style="color: #cc66cc;">"and"</span> <span style="color: #339933;">+</span> words<span style="color: #339933;">[</span>tenth<span style="color: #339933;">]</span>
        <span style="color: #339933;">}</span> <span style="color: #b1b100; font-weight: bold;">else</span> <span style="color: #339933;">{</span>
            <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> hundred <span style="color: #339933;">+</span> <span style="color: #cc66cc;">"and"</span> <span style="color: #339933;">+</span> countMiddle<span style="color: #339933;">(</span>tenth<span style="color: #339933;">)</span>
        <span style="color: #339933;">}</span>
&nbsp;
    <span style="color: #339933;">}</span>
&nbsp;
    <span style="color: #b1b100; font-weight: bold;">if</span> num <span style="color: #339933;">==</span> <span style="color: #cc66cc;">1000</span> <span style="color: #339933;">{</span>
        <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">"onethousand"</span>
    <span style="color: #339933;">}</span>
<span style="color: #339933;">}</span>
&nbsp;
<span style="color: #993333;">func</span> countMiddle<span style="color: #339933;">(</span>num <span style="color: #993333;">int</span><span style="color: #339933;">)</span> <span style="color: #993333;">string</span> <span style="color: #339933;">{</span>
    minues <span style="color: #339933;">:=</span> num <span style="color: #339933;">%</span> <span style="color: #cc66cc;">10</span>
    num <span style="color: #339933;">-=</span> minues
    <span style="color: #b1b100; font-weight: bold;">return</span> words<span style="color: #339933;">[</span>num<span style="color: #339933;">]</span> <span style="color: #339933;">+</span> words<span style="color: #339933;">[</span>minues<span style="color: #339933;">]</span>
<span style="color: #339933;">}</span>
&nbsp;
<span style="color: #993333;">func</span> countHundred<span style="color: #339933;">(</span>num <span style="color: #993333;">int</span><span style="color: #339933;">)</span> <span style="color: #339933;">(</span><span style="color: #993333;">string</span><span style="color: #339933;">,</span> <span style="color: #993333;">int</span><span style="color: #339933;">)</span> <span style="color: #339933;">{</span>
    minues <span style="color: #339933;">:=</span> num <span style="color: #339933;">%</span> <span style="color: #cc66cc;">100</span>
    num <span style="color: #339933;">-=</span> minues
    <span style="color: #b1b100; font-weight: bold;">return</span> <span style="color: #339933;">(</span>words<span style="color: #339933;">[(</span>num<span style="color: #339933;">/</span><span style="color: #cc66cc;">100</span><span style="color: #339933;">)]</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">"hundred"</span><span style="color: #339933;">),</span> minues
<span style="color: #339933;">}</span></pre>
      </td>
    </tr>
  </table>
</div>

                    </div>
                </section>
                
                <h1 class="content-subhead">19 Jul 2015, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2015/07/19/converting-numbers-into-string-representations/" class="post-title">Converting numbers into string representations</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-problem solving" href="https://skarlso.github.io//categories/problem-solving">problem solving</a><a class="post-category post-category-programming" href="https://skarlso.github.io//categories/programming">programming</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>I quiet like this one. My first go program snippet without any peaking or googling. I&#8217;m proud, though it could be improved with a bit of struct magic and such and such. And it only counts &#8217;till 1000&#8230;</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="go" style="font-family:monospace;"><span style="color: #b1b100; font-weight: bold;">package</span> main
&nbsp;
<span style="color: #b1b100; font-weight: bold;">import</span> <span style="color: #cc66cc;">"fmt"</span>
&nbsp;
<span style="color: #b1b100; font-weight: bold;">var</span> words <span style="color: #339933;">=</span> <span style="color: #993333;">map</span><span style="color: #339933;">[</span><span style="color: #993333;">int</span><span style="color: #339933;">]</span><span style="color: #993333;">string</span><span style="color: #339933;">{</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"one"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">2</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"two"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">3</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"three"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"four"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">5</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"five"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">6</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"six"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">7</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"seven"</span><span style="color: #339933;">,</span>
    <span style="color: #cc66cc;">8</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"eight"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">9</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"nine"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">10</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"ten"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">11</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"eleven"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">12</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"twelve"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">13</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"thirteen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">14</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"fourteen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">15</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"fifteen"</span><span style="color: #339933;">,</span>
    <span style="color: #cc66cc;">16</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"sixteen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">17</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"seventeen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">18</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"eighteen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">19</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"nineteen"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">20</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"twenty"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">30</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"thirty"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">40</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"forty"</span><span style="color: #339933;">,</span>
    <span style="color: #cc66cc;">50</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"fifty"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">60</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"sixty"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">70</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"seventy"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">80</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"eighty"</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">90</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">"ninety"</span><span style="color: #339933;">}</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// CountLetters count the letters in a long string number representation</span>
<span style="color: #993333;">func</span> CountLetters<span style="color: #339933;">(</span>limit <span style="color: #993333;">int</span><span style="color: #339933;">)</span> <span style="color: #339933;">{</span>
    myLongNumberString <span style="color: #339933;">:=</span> <span style="color: #cc66cc;">""</span>
    <span style="color: #b1b100; font-weight: bold;">for</span> <span style="">i</span> <span style="color: #339933;">:=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="">i</span> &lt;<span style="color: #339933;">=</span> limit<span style="color: #339933;">;</span> <span style="">i</span><span style="color: #339933;">++</span> <span style="color: #339933;">{</span>
        addLettersToMyString<span style="color: #339933;">(</span>&myLongNumberString<span style="color: #339933;">,</span> <span style="">i</span><span style="color: #339933;">)</span>
    <span style="color: #339933;">}</span>
    <span style="color: #666666; font-style: italic;">// fmt.Println("1-9 written with letters is: ", len(myLongNumberString))</span>
    fmt<span style="color: #339933;">.</span><span style="">Println</span><span style="color: #339933;">(</span><span style="color: #cc66cc;">"The string is:"</span><span style="color: #339933;">,</span> myLongNumberString<span style="color: #339933;">)</span>
    fmt<span style="color: #339933;">.</span><span style="">Println</span><span style="color: #339933;">(</span><span style="color: #cc66cc;">"Lenght of string is:"</span><span style="color: #339933;">,</span> <span style="color: #000066;">len</span><span style="color: #339933;">(</span>myLongNumberString<span style="color: #339933;">))</span>
<span style="color: #339933;">}</span>
&nbsp;
<span style="color: #993333;">func</span> addLettersToMyString<span style="color: #339933;">(</span>myString <span style="color: #339933;">*</span><span style="color: #993333;">string</span><span style="color: #339933;">,</span> num <span style="color: #993333;">int</span><span style="color: #339933;">)</span> <span style="color: #339933;">{</span>
    <span style="color: #b1b100; font-weight: bold;">if</span> num &lt; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">{</span>
        <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> words<span style="color: #339933;">[</span>num<span style="color: #339933;">]</span>
    <span style="color: #339933;">}</span>
&nbsp;
    <span style="color: #b1b100; font-weight: bold;">if</span> num &gt;<span style="color: #339933;">=</span> <span style="color: #cc66cc;">20</span> && num &lt; <span style="color: #cc66cc;">100</span> <span style="color: #339933;">{</span>
        <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> countMiddle<span style="color: #339933;">(</span>num<span style="color: #339933;">)</span>
    <span style="color: #339933;">}</span>
&nbsp;
    <span style="color: #b1b100; font-weight: bold;">if</span> num &gt;<span style="color: #339933;">=</span> <span style="color: #cc66cc;">100</span> && num &lt; <span style="color: #cc66cc;">1000</span> <span style="color: #339933;">{</span>
        hundred<span style="color: #339933;">,</span> tenth <span style="color: #339933;">:=</span> countHundred<span style="color: #339933;">(</span>num<span style="color: #339933;">)</span>
        <span style="color: #b1b100; font-weight: bold;">if</span> tenth <span style="color: #339933;">==</span> <span style="color: #cc66cc;"></span> <span style="color: #339933;">{</span>
            <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> hundred
        <span style="color: #339933;">}</span> <span style="color: #b1b100; font-weight: bold;">else</span> <span style="color: #b1b100; font-weight: bold;">if</span> tenth &gt;<span style="color: #339933;">=</span> <span style="color: #cc66cc;">11</span> && tenth &lt; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">{</span>
            <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> hundred <span style="color: #339933;">+</span> <span style="color: #cc66cc;">"and"</span> <span style="color: #339933;">+</span> words<span style="color: #339933;">[</span>tenth<span style="color: #339933;">]</span>
        <span style="color: #339933;">}</span> <span style="color: #b1b100; font-weight: bold;">else</span> <span style="color: #339933;">{</span>
            <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> hundred <span style="color: #339933;">+</span> <span style="color: #cc66cc;">"and"</span> <span style="color: #339933;">+</span> countMiddle<span style="color: #339933;">(</span>tenth<span style="color: #339933;">)</span>
        <span style="color: #339933;">}</span>
&nbsp;
    <span style="color: #339933;">}</span>
&nbsp;
    <span style="color: #b1b100; font-weight: bold;">if</span> num <span style="color: #339933;">==</span> <span style="color: #cc66cc;">1000</span> <span style="color: #339933;">{</span>
        <span style="color: #339933;">*</span>myString <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">"onethousand"</span>
    <span style="color: #339933;">}</span>
<span style="color: #339933;">}</span>
&nbsp;
<span style="color: #993333;">func</span> countMiddle<span style="color: #339933;">(</span>num <span style="color: #993333;">int</span><span style="color: #339933;">)</span> <span style="color: #993333;">string</span> <span style="color: #339933;">{</span>
    minues <span style="color: #339933;">:=</span> num <span style="color: #339933;">%</span> <span style="color: #cc66cc;">10</span>
    num <span style="color: #339933;">-=</span> minues
    <span style="color: #b1b100; font-weight: bold;">return</span> words<span style="color: #339933;">[</span>num<span style="color: #339933;">]</span> <span style="color: #339933;">+</span> words<span style="color: #339933;">[</span>minues<span style="color: #339933;">]</span>
<span style="color: #339933;">}</span>
&nbsp;
<span style="color: #993333;">func</span> countHundred<span style="color: #339933;">(</span>num <span style="color: #993333;">int</span><span style="color: #339933;">)</span> <span style="color: #339933;">(</span><span style="color: #993333;">string</span><span style="color: #339933;">,</span> <span style="color: #993333;">int</span><span style="color: #339933;">)</span> <span style="color: #339933;">{</span>
    minues <span style="color: #339933;">:=</span> num <span style="color: #339933;">%</span> <span style="color: #cc66cc;">100</span>
    num <span style="color: #339933;">-=</span> minues
    <span style="color: #b1b100; font-weight: bold;">return</span> <span style="color: #339933;">(</span>words<span style="color: #339933;">[(</span>num<span style="color: #339933;">/</span><span style="color: #cc66cc;">100</span><span style="color: #339933;">)]</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">"hundred"</span><span style="color: #339933;">),</span> minues
<span style="color: #339933;">}</span></pre>
      </td>
    </tr>
  </table>
</div>

                    </div>
                </section>
                
                <h1 class="content-subhead">16 Jul 2015, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2015/07/16/selenium-testing-with-packer-and-vagrant/" class="post-title">Selenium Testing with Packer and Vagrant</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-devops" href="https://skarlso.github.io//categories/devops">devops</a><a class="post-category post-category-problem solving" href="https://skarlso.github.io//categories/problem-solving">problem solving</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>So, recently, the tester team talked to me, that their build takes too long, and why is that? A quick look at their configuration and build scripts showed me, that they are actually using a vagrant box, which never gets destroyed or re-started at least. To remedy this problem, I came up with the following solution&#8230;</p>

<h1 id="same-old-8230">Same old&#8230;</h1>

<p>Same as in my previous post, we are going to build a Windows Machine for this purpose. The only addition to my previous settings, will be some Java install, downloading selenium and installing Chrome, and Firefox.</p>

<h1 id="installation">Installation</h1>

<h4 id="answer-file">Answer File</h4>

<p>Here is the configuration and setup of Windows before the provision phase.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="xml" style="font-family:monospace;">...
               <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;SynchronousCommand</span> <span style="color: #000066;">wcm:action</span>=<span style="color: #ff0000;">"add"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;CommandLine<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>cmd.exe /c C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -File a:\jdk_inst.ps1 -AutoStart<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/CommandLine<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Description<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Install Java<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Description<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>103<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RequiresUserInput<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>true<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/RequiresUserInput<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
               <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/SynchronousCommand<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
...</pre>
      </td>
    </tr>
  </table>
</div>

<p>This is the part were I&#8217;m installing Java. The script for the jdk_inst.ps1 is in my previous post, but I&#8217;ll paste it here for ease of read.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="powershell" style="font-family:monospace;"><span style="color: #0000FF;">function</span> LogWrite <span style="color: #000000;">&#123;</span>
   <span style="color: #0000FF;">Param</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span><span style="color: #008080;">string</span><span style="color: #000000;">&#93;</span><span style="color: #800080;">$logstring</span><span style="color: #000000;">&#41;</span>
   <span style="color: #800080;">$now</span> <span style="color: pink;">=</span> <span style="color: #008080; font-weight: bold;">Get-Date</span> <span style="color: #008080; font-style: italic;">-format</span> s
   <span style="color: #008080; font-weight: bold;">Add-Content</span> <span style="color: #800080;">$Logfile</span> <span style="color: #008080; font-style: italic;">-value</span> <span style="color: #800000;">"$now $logstring"</span>
   <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800080;">$logstring</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #800080;">$Logfile</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\jdk-install.log"</span>
&nbsp;
<span style="color: #800080;">$JDK_VER</span><span style="color: pink;">=</span><span style="color: #800000;">"7u75"</span>
<span style="color: #800080;">$JDK_FULL_VER</span><span style="color: pink;">=</span><span style="color: #800000;">"7u75-b13"</span>
<span style="color: #800080;">$JDK_PATH</span><span style="color: pink;">=</span><span style="color: #800000;">"1.7.0_75"</span>
<span style="color: #800080;">$source86</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://download.oracle.com/otn-pub/java/jdk/$JDK_FULL_VER/jdk-$JDK_VER-windows-i586.exe"</span>
<span style="color: #800080;">$source64</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://download.oracle.com/otn-pub/java/jdk/$JDK_FULL_VER/jdk-$JDK_VER-windows-x64.exe"</span>
<span style="color: #800080;">$destination86</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\$JDK_VER-x86.exe"</span>
<span style="color: #800080;">$destination64</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\$JDK_VER-x64.exe"</span>
<span style="color: #800080;">$client</span> <span style="color: pink;">=</span> <span style="color: #008080; font-weight: bold;">new-object</span> System.Net.WebClient
<span style="color: #800080;">$cookie</span> <span style="color: pink;">=</span> <span style="color: #800000;">"oraclelicense=accept-securebackup-cookie"</span>
<span style="color: #800080;">$client</span>.Headers.Add<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>System.Net.HttpRequestHeader<span style="color: #000000;">&#93;</span>::Cookie<span style="color: pink;">,</span> <span style="color: #800080;">$cookie</span><span style="color: #000000;">&#41;</span>
&nbsp;
LogWrite <span style="color: #800000;">"Setting Execution Policy level to Bypass"</span>
<span style="color: #008080; font-weight: bold;">Set-ExecutionPolicy</span> <span style="color: #008080; font-style: italic;">-Scope</span> CurrentUser <span style="color: #008080; font-style: italic;">-ExecutionPolicy</span> Bypass <span style="color: #008080; font-style: italic;">-Force</span>
&nbsp;
LogWrite <span style="color: #800000;">'Checking if Java is already installed'</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files (x86)\Java"</span><span style="color: #000000;">&#41;</span> <span style="color: #FF0000;">-Or</span> <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files\Java"</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'No need to Install Java'</span>
    Exit
<span style="color: #000000;">&#125;</span>
&nbsp;
LogWrite <span style="color: #800000;">'Downloading x86 to $destination86'</span>
try <span style="color: #000000;">&#123;</span>
  <span style="color: #800080;">$client</span>.downloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source86</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination86</span><span style="color: #000000;">&#41;</span>
  <span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination86</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
      LogWrite <span style="color: #800000;">"Downloading $destination86 failed"</span>
      Exit
  <span style="color: #000000;">&#125;</span>
  LogWrite <span style="color: #800000;">'Downloading x64 to $destination64'</span>
&nbsp;
  <span style="color: #800080;">$client</span>.downloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source64</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination64</span><span style="color: #000000;">&#41;</span>
  <span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination64</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
      LogWrite <span style="color: #800000;">"Downloading $destination64 failed"</span>
      Exit
  <span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
  LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
&nbsp;
try <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Installing JDK-x64'</span>
    <span style="color: #800080;">$proc1</span> <span style="color: pink;">=</span> Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800000;">"$destination64"</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/s REBOOT=ReallySuppress"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
    <span style="color: #800080;">$proc1</span>.waitForExit<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
    LogWrite <span style="color: #800000;">'Installation Done.'</span>
&nbsp;
    LogWrite <span style="color: #800000;">'Installing JDK-x86'</span>
    <span style="color: #800080;">$proc2</span> <span style="color: pink;">=</span> Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800000;">"$destination86"</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/s REBOOT=ReallySuppress"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
    <span style="color: #800080;">$proc2</span>.waitForExit<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
    LogWrite <span style="color: #800000;">'Installtion Done.'</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'$_ is'</span> <span style="color: #000080;">$_</span>
    LogWrite <span style="color: #800000;">'$_.GetType().FullName is'</span> <span style="color: #000080;">$_</span>.GetType<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.FullName
    LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
    LogWrite <span style="color: #800000;">'$_.Exception.GetType().FullName is'</span> <span style="color: #000080;">$_</span>.Exception.GetType<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.FullName
    LogWrite <span style="color: #800000;">'$_.Exception.Message is'</span> <span style="color: #000080;">$_</span>.Exception.Message
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files (x86)\Java"</span><span style="color: #000000;">&#41;</span> <span style="color: #FF0000;">-Or</span> <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files\Java"</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Java installed successfully.'</span>
<span style="color: #000000;">&#125;</span> <span style="color: #0000FF;">else</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Java install Failed!'</span>
<span style="color: #000000;">&#125;</span>
LogWrite <span style="color: #800000;">'Setting up Path variables.'</span>
<span style="color: #000000;">&#91;</span>System.Environment<span style="color: #000000;">&#93;</span>::SetEnvironmentVariable<span style="color: #000000;">&#40;</span><span style="color: #800000;">"JAVA_HOME"</span><span style="color: pink;">,</span> <span style="color: #800000;">"c:\Program Files (x86)\Java\jdk$JDK_PATH"</span><span style="color: pink;">,</span> <span style="color: #800000;">"Machine"</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#91;</span>System.Environment<span style="color: #000000;">&#93;</span>::SetEnvironmentVariable<span style="color: #000000;">&#40;</span><span style="color: #800000;">"PATH"</span><span style="color: pink;">,</span> <span style="color: #800080;">$Env</span>:Path <span style="color: pink;">+</span> <span style="color: #800000;">";c:\Program Files (x86)\Java\jdk$JDK_PATH\bin"</span><span style="color: pink;">,</span> <span style="color: #800000;">"Machine"</span><span style="color: #000000;">&#41;</span>
LogWrite <span style="color: #800000;">'Done. Goodbye.'</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>This installs both x86 and 64 bit version of Java.</p>

<h1 id="provision">Provision</h1>

<p>I decided to put these into the provision phase to get log messages written out properly. Because in the unattended file, you can&#8217;t see any progress.</p>

<h4 id="chrome-and-firefox">Chrome And Firefox</h4>

<p>Installing these two proved a little bit more difficult. Chrome didn&#8217;t really like me to download their installer without accepting something first, like Java. Luckily, after a LOT of digging, I found a chrome installer which lets you install silently. Here is the script to install the two.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="powershell" style="font-family:monospace;"><span style="color: #0000FF;">function</span> LogWrite <span style="color: #000000;">&#123;</span>
    <span style="color: #0000FF;">Param</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span><span style="color: #008080;">string</span><span style="color: #000000;">&#93;</span><span style="color: #800080;">$logstring</span><span style="color: #000000;">&#41;</span>
    <span style="color: #800080;">$now</span> <span style="color: pink;">=</span> <span style="color: #008080; font-weight: bold;">Get-Date</span> <span style="color: #008080; font-style: italic;">-format</span> s
    <span style="color: #008080; font-weight: bold;">Add-Content</span> <span style="color: #800080;">$Logfile</span> <span style="color: #008080; font-style: italic;">-value</span> <span style="color: #800000;">"$now $logstring"</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800080;">$logstring</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #0000FF;">function</span> CheckLocation <span style="color: #000000;">&#123;</span>
    <span style="color: #0000FF;">Param</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span><span style="color: #008080;">string</span><span style="color: #000000;">&#93;</span><span style="color: #800080;">$location</span><span style="color: #000000;">&#41;</span>
    <span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span>  <span style="color: #800080;">$location</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
        <span style="color: #0000FF;">throw</span> <span style="color: #000000;">&#91;</span>System.IO.FileNotFoundException<span style="color: #000000;">&#93;</span> <span style="color: #800000;">"Could not download to Destination $location."</span>
    <span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #800080;">$Logfile</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\chrome-firefox-install.log"</span>
&nbsp;
<span style="color: #800080;">$chrome_source</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://dl.google.com/chrome/install/375.126/chrome_installer.exe"</span>
<span style="color: #800080;">$chrome_destination</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\chrome_installer.exe"</span>
<span style="color: #800080;">$firefox_source</span> <span style="color: pink;">=</span> <span style="color: #800000;">"https://download-installer.cdn.mozilla.net/pub/firefox/releases/39.0/win32/hu/Firefox%20Setup%2039.0.exe"</span>
<span style="color: #800080;">$firefox_destination</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\firefoxinstaller.exe"</span>
&nbsp;
LogWrite <span style="color: #800000;">'Starting to download files.'</span>
try <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Downloading Chrome...'</span>
    <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">New-Object</span> System.Net.WebClient<span style="color: #000000;">&#41;</span>.DownloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$chrome_source</span><span style="color: pink;">,</span> <span style="color: #800080;">$chrome_destination</span><span style="color: #000000;">&#41;</span>
    CheckLocation <span style="color: #800080;">$chrome_destination</span>
    LogWrite <span style="color: #800000;">'Done...'</span>
    LogWrite <span style="color: #800000;">'Downloading Firefox...'</span>
    <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">New-Object</span> System.Net.WebClient<span style="color: #000000;">&#41;</span>.DownloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$firefox_source</span><span style="color: pink;">,</span> <span style="color: #800080;">$firefox_destination</span><span style="color: #000000;">&#41;</span>
    CheckLocation <span style="color: #800080;">$firefox_destination</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">"Exception during download. Probable cause could be that the directory or the file didn't exist."</span>
    LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
&nbsp;
LogWrite <span style="color: #800000;">'Starting firefox install process.'</span>
try <span style="color: #000000;">&#123;</span>
    Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800080;">$firefox_destination</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"-ms"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Exception during install process.'</span>
    LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
LogWrite <span style="color: #800000;">'Starting chrome install process.'</span>
&nbsp;
try <span style="color: #000000;">&#123;</span>
    Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800080;">$chrome_destination</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/silent /install"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Exception during install process.'</span>
    LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
&nbsp;
LogWrite <span style="color: #800000;">'All done. Goodbye.'</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>They both install silently. Pretty neat.</p>

<h4 id="selenium">Selenium</h4>

<p>This only has to be downloaded, so this is pretty simple. Vagrant will handle the startup of course when it does a vagrant up.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="powershell" style="font-family:monospace;"><span style="color: #0000FF;">function</span> LogWrite <span style="color: #000000;">&#123;</span>
   <span style="color: #0000FF;">Param</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span><span style="color: #008080;">string</span><span style="color: #000000;">&#93;</span><span style="color: #800080;">$logstring</span><span style="color: #000000;">&#41;</span>
   <span style="color: #800080;">$now</span> <span style="color: pink;">=</span> <span style="color: #008080; font-weight: bold;">Get-Date</span> <span style="color: #008080; font-style: italic;">-format</span> s
   <span style="color: #008080; font-weight: bold;">Add-Content</span> <span style="color: #800080;">$Logfile</span> <span style="color: #008080; font-style: italic;">-value</span> <span style="color: #800000;">"$now $logstring"</span>
   <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800080;">$logstring</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #800080;">$Logfile</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\selenium-install.log"</span>
&nbsp;
<span style="color: #800080;">$source</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://selenium-release.storage.googleapis.com/2.46/selenium-server-standalone-2.46.0.jar"</span>
<span style="color: #800080;">$destination</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\selenium-server.jar"</span>
LogWrite <span style="color: #800000;">'Starting to download selenium file.'</span>
try <span style="color: #000000;">&#123;</span>
  <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">New-Object</span> System.Net.WebClient<span style="color: #000000;">&#41;</span>.DownloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
  LogWrite <span style="color: #800000;">"Exception during download. Probable cause could be that the directory or the file didn't exist."</span>
  LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
LogWrite <span style="color: #800000;">'Download done. Checking if file exists.'</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
  LogWrite <span style="color: #800000;">'Downloading dotnet Failed!'</span>
<span style="color: #000000;">&#125;</span> <span style="color: #0000FF;">else</span> <span style="color: #000000;">&#123;</span>
  LogWrite <span style="color: #800000;">'Download successful.'</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
LogWrite <span style="color: #800000;">'All done. Goodbye.'</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>Straightforward.</p>

<h4 id="the-packer-json-file">The Packer Json File</h4>

<p>So putting this all together, here is the Packer JSON file for this:</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="json" style="font-family:monospace;">{
      "variables": {
      "vm_name": "win7x64selenium",
      "output_dir": "output_win7_x64_selenium",
      "vagrant_box_output": "box_output",
      "cpu_number": "2",
      "memory_size": "4096",
      "machine_type": "pc-1.2",
      "accelerator": "kvm",
      "disk_format": "qcow2",
      "disk_interface": "virtio",
      "net_device": "virtio-net",
      "cpu_model": "host",
      "disk_cache": "writeback",
      "disk_io": "native"
   },
&nbsp;
  "builders": [
    {
      "type": "virtualbox-iso",
      "iso_url": "/home/user/vms/windows7.iso",
      "iso_checksum_type": "sha1",
      "iso_checksum": "0BCFC54019EA175B1EE51F6D2B207A3D14DD2B58",
      "headless": true,
      "boot_wait": "2m",
      "ssh_username": "vagrant",
      "ssh_password": "vagrant",
      "ssh_wait_timeout": "8h",
      "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
      "guest_os_type": "Windows7_64",
      "disk_size": 61440,
      "floppy_files": [
        "./answer_files/7-selenium/Autounattend.xml",
        "./scripts/dis-updates.ps1",
        "./scripts/microsoft-updates.bat",
        "./scripts/openssh.ps1",
        "./scripts/jdk_inst.ps1"
      ],
      "vboxmanage": [
        [
          "modifyvm",
          "{{.Name}}",
          "--memory",
          "{{user `memory_size`}}"
        ],
        [
          "modifyvm",
          "{{.Name}}",
          "--cpus",
          "{{user `cpu_number`}}"
        ]
      ]
    }
  ],
  "provisioners": [
    {
      "type": "powershell",
      "scripts" : [
        "./scripts/install-selenium-server.ps1",
        "./scripts/install-chrome-firefox.ps1"
      ]
    },{
      "type": "shell",
      "remote_path": "/tmp/script.bat",
      "execute_command": "{{.Vars}} cmd /c C:/Windows/Temp/script.bat",
      "scripts": [
        "./scripts/vm-guest-tools.bat",
        "./scripts/vagrant-ssh.bat",
        "./scripts/rsync.bat",
        "./scripts/enable-rdp.bat"
      ]
    }
  ],
    "post-processors": [
    {
      "type": "vagrant",
      "keep_input_artifact": false,
      "output": "{{user `vm_name`}}_{{.Provider}}.box",
      "vagrantfile_template": "vagrantfile-template"
    }
    ]
}</pre>
      </td>
    </tr>
  </table>
</div>

<h4 id="additional-software">Additional Software</h4>

<p>This is not done here. Obviously, in order to test your stuff, you first need to install your software on this box. Ideally, everything you need should be in the code you clone to this box, and should be contained mostly. And your application deployment should take core of that. But, if you require something like a DB, postgres, oracle, whatnot, than this is the place where you would install all that.</p>

<h1 id="vagrant-and-using-the-packer-box">Vagrant and Using the Packer Box</h1>

<p>Now, this has been interesting so far, but how do you actually go about using this image? That&#8217;s the real question now, isn&#8217;t it? Having a box, just sitting on a shared folder, doesn&#8217;t do you too much good. So let&#8217;s create a Jenkins job, which utilizes this box in a job which runs a bunch of tests for some application.</p>

<h4 id="vagrantfile">Vagrantfile</h4>

<p>Your vagrant file, could either be generated automatically, under source control ( which is preferred ) or sitting somewhere entirely elsewhere. In any case, it would look something like this.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="ruby" style="font-family:monospace;"><span style="color:#008000; font-style:italic;"># -*- mode: ruby -*-</span>
<span style="color:#008000; font-style:italic;"># vi: set ft=ruby :</span>
&nbsp;
VAGRANTFILE_API_VERSION = <span style="color:#996600;">"2"</span>
&nbsp;
Vagrant.<span style="color:#9900CC;">configure</span><span style="color:#006600; font-weight:bold;">&#40;</span>VAGRANTFILE_API_VERSION<span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>config<span style="color:#006600; font-weight:bold;">|</span>
&nbsp;
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provider</span> <span style="color:#996600;">"virtualbox"</span>
&nbsp;
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">define</span> <span style="color:#996600;">"selenium-box"</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>vs2013<span style="color:#006600; font-weight:bold;">|</span>
    vs2013.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">box</span> = <span style="color:#996600;">"windows7-x64-04-selenium"</span>
    vs2013.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">box_url</span> = <span style="color:#996600;">"path/to/your/share/win7x64_selenium_virtualbox.box"</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
  config.<span style="color:#9900CC;">env</span>.<span style="color:#9900CC;">enable</span>
&nbsp;
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">guest</span> = <span style="color:#ff3333; font-weight:bold;">:windows</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">communicator</span> = <span style="color:#996600;">"winrm"</span>
  config.<span style="color:#9900CC;">winrm</span>.<span style="color:#9900CC;">username</span> = <span style="color:#996600;">"vagrant"</span>
  config.<span style="color:#9900CC;">winrm</span>.<span style="color:#9900CC;">password</span> = <span style="color:#996600;">"vagrant"</span>
  config.<span style="color:#9900CC;">windows</span>.<span style="color:#9900CC;">set_work_network</span> = <span style="color:#0000FF; font-weight:bold;">true</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">network</span> <span style="color:#ff3333; font-weight:bold;">:forwarded_port</span>, guest: <span style="color:#006666;">3389</span>, host: ENV<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">'RDESKTOP_PORT'</span><span style="color:#006600; font-weight:bold;">&#93;</span>, host_ip: <span style="color:#996600;">"0.0.0.0"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">network</span> <span style="color:#ff3333; font-weight:bold;">:forwarded_port</span>, guest: <span style="color:#006666;">5985</span>, host: <span style="color:#006666;">5985</span>, id: <span style="color:#996600;">"winrm"</span>, auto_correct: <span style="color:#0000FF; font-weight:bold;">true</span>, host_ip: <span style="color:#996600;">"0.0.0.0"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">network</span> <span style="color:#ff3333; font-weight:bold;">:forwarded_port</span>, guest: <span style="color:#006666;">9991</span>, host: <span style="color:#006666;">9991</span>, id: <span style="color:#996600;">"selenium"</span>, auto_correct: <span style="color:#0000FF; font-weight:bold;">true</span>, host_ip: <span style="color:#996600;">"0.0.0.0"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provider</span> <span style="color:#ff3333; font-weight:bold;">:virtualbox</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>vbox<span style="color:#006600; font-weight:bold;">|</span>
    vbox.<span style="color:#9900CC;">gui</span> = <span style="color:#0000FF; font-weight:bold;">false</span>
    vbox.<span style="color:#9900CC;">memory</span> = <span style="color:#006666;">4096</span>
    vbox.<span style="color:#9900CC;">cpus</span> = <span style="color:#006666;">2</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
&nbsp;
  config.<span style="color:#9900CC;">winrm</span>.<span style="color:#9900CC;">max_tries</span> = <span style="color:#006666;">10</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">synced_folder</span> <span style="color:#996600;">"."</span>, <span style="color:#996600;">"/vagrant"</span>, type: <span style="color:#996600;">"rsync"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provision</span> <span style="color:#996600;">"shell"</span>, path: <span style="color:#996600;">"init.bat"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provision</span> <span style="color:#996600;">"shell"</span>, path: <span style="color:#996600;">"utils_inst.bat"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provision</span> <span style="color:#996600;">"shell"</span>, path: <span style="color:#996600;">"jenkins_reg.ps1"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provision</span> <span style="color:#996600;">"shell"</span>, path: <span style="color:#996600;">"start_selenium.bat"</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>Easy, no? Here is the script to start selenium.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="batch" style="font-family:monospace;">    java -jar c:\Windows\Temp\selenium-server.jar -Dhttp.proxyPort=9991</pre>
      </td>
    </tr>
  </table>
</div>

<p>Straight forward. We also are forwarding the port on which Selenium is running in order for the test to see it.</p>

<h4 id="the-jenkins-job">The Jenkins Job</h4>

<p>The job can be anything. This is actually too large to cover here. It could be a gradle job, a maven job, an ant, a nant &#8211; or whatever is running the test -, job; it&#8217;s up to you.</p>

<p>Just make sure that before the test runs, do a <strong>vagrant up</strong> and after the test finishes, in an ALWAYS TO BE EXECUTED HOOK -like gradle&#8217;s finalizedBy , call a <strong>vagrant destroy</strong>. This way, your test will always run on a clean instance that has the necessary stuff on it.</p>

<h1 id="closing-words">Closing words</h1>

<p>So, there you have it. It&#8217;s relatively simple. Tying this all into your infrastructure might prove difficult though depending on how rigid your deployment is. But it will always help you make your tests a bit more robust.</p>

<p>Also, you could run the whole deployment and test phase on a vagrant box, from the start, which is tied to jenkins as a slave and gets started when the job starts and destroyed when the job ends. That way you wouldn&#8217;t have to create a, box in a box running on a box, kind of effect.</p>

<p>Thanks for reading,</p>

<p>Gergely.</p>
                    </div>
                </section>
                
                <h1 class="content-subhead">16 Jul 2015, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2015/07/16/selenium-testing-with-packer-and-vagrant/" class="post-title">Selenium Testing with Packer and Vagrant</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-devops" href="https://skarlso.github.io//categories/devops">devops</a><a class="post-category post-category-problem solving" href="https://skarlso.github.io//categories/problem-solving">problem solving</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>So, recently, the tester team talked to me, that their build takes too long, and why is that? A quick look at their configuration and build scripts showed me, that they are actually using a vagrant box, which never gets destroyed or re-started at least. To remedy this problem, I came up with the following solution&#8230;</p>

<h1 id="same-old-8230">Same old&#8230;</h1>

<p>Same as in my previous post, we are going to build a Windows Machine for this purpose. The only addition to my previous settings, will be some Java install, downloading selenium and installing Chrome, and Firefox.</p>

<h1 id="installation">Installation</h1>

<h4 id="answer-file">Answer File</h4>

<p>Here is the configuration and setup of Windows before the provision phase.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="xml" style="font-family:monospace;">...
               <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;SynchronousCommand</span> <span style="color: #000066;">wcm:action</span>=<span style="color: #ff0000;">"add"</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>
                  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;CommandLine<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>cmd.exe /c C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -File a:\jdk_inst.ps1 -AutoStart<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/CommandLine<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Description<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>Install Java<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Description<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;Order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>103<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/Order<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
                  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;RequiresUserInput<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>true<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/RequiresUserInput<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
               <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/SynchronousCommand<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
...</pre>
      </td>
    </tr>
  </table>
</div>

<p>This is the part were I&#8217;m installing Java. The script for the jdk_inst.ps1 is in my previous post, but I&#8217;ll paste it here for ease of read.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="powershell" style="font-family:monospace;"><span style="color: #0000FF;">function</span> LogWrite <span style="color: #000000;">&#123;</span>
   <span style="color: #0000FF;">Param</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span><span style="color: #008080;">string</span><span style="color: #000000;">&#93;</span><span style="color: #800080;">$logstring</span><span style="color: #000000;">&#41;</span>
   <span style="color: #800080;">$now</span> <span style="color: pink;">=</span> <span style="color: #008080; font-weight: bold;">Get-Date</span> <span style="color: #008080; font-style: italic;">-format</span> s
   <span style="color: #008080; font-weight: bold;">Add-Content</span> <span style="color: #800080;">$Logfile</span> <span style="color: #008080; font-style: italic;">-value</span> <span style="color: #800000;">"$now $logstring"</span>
   <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800080;">$logstring</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #800080;">$Logfile</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\jdk-install.log"</span>
&nbsp;
<span style="color: #800080;">$JDK_VER</span><span style="color: pink;">=</span><span style="color: #800000;">"7u75"</span>
<span style="color: #800080;">$JDK_FULL_VER</span><span style="color: pink;">=</span><span style="color: #800000;">"7u75-b13"</span>
<span style="color: #800080;">$JDK_PATH</span><span style="color: pink;">=</span><span style="color: #800000;">"1.7.0_75"</span>
<span style="color: #800080;">$source86</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://download.oracle.com/otn-pub/java/jdk/$JDK_FULL_VER/jdk-$JDK_VER-windows-i586.exe"</span>
<span style="color: #800080;">$source64</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://download.oracle.com/otn-pub/java/jdk/$JDK_FULL_VER/jdk-$JDK_VER-windows-x64.exe"</span>
<span style="color: #800080;">$destination86</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\$JDK_VER-x86.exe"</span>
<span style="color: #800080;">$destination64</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\$JDK_VER-x64.exe"</span>
<span style="color: #800080;">$client</span> <span style="color: pink;">=</span> <span style="color: #008080; font-weight: bold;">new-object</span> System.Net.WebClient
<span style="color: #800080;">$cookie</span> <span style="color: pink;">=</span> <span style="color: #800000;">"oraclelicense=accept-securebackup-cookie"</span>
<span style="color: #800080;">$client</span>.Headers.Add<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>System.Net.HttpRequestHeader<span style="color: #000000;">&#93;</span>::Cookie<span style="color: pink;">,</span> <span style="color: #800080;">$cookie</span><span style="color: #000000;">&#41;</span>
&nbsp;
LogWrite <span style="color: #800000;">"Setting Execution Policy level to Bypass"</span>
<span style="color: #008080; font-weight: bold;">Set-ExecutionPolicy</span> <span style="color: #008080; font-style: italic;">-Scope</span> CurrentUser <span style="color: #008080; font-style: italic;">-ExecutionPolicy</span> Bypass <span style="color: #008080; font-style: italic;">-Force</span>
&nbsp;
LogWrite <span style="color: #800000;">'Checking if Java is already installed'</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files (x86)\Java"</span><span style="color: #000000;">&#41;</span> <span style="color: #FF0000;">-Or</span> <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files\Java"</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'No need to Install Java'</span>
    Exit
<span style="color: #000000;">&#125;</span>
&nbsp;
LogWrite <span style="color: #800000;">'Downloading x86 to $destination86'</span>
try <span style="color: #000000;">&#123;</span>
  <span style="color: #800080;">$client</span>.downloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source86</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination86</span><span style="color: #000000;">&#41;</span>
  <span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination86</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
      LogWrite <span style="color: #800000;">"Downloading $destination86 failed"</span>
      Exit
  <span style="color: #000000;">&#125;</span>
  LogWrite <span style="color: #800000;">'Downloading x64 to $destination64'</span>
&nbsp;
  <span style="color: #800080;">$client</span>.downloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source64</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination64</span><span style="color: #000000;">&#41;</span>
  <span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination64</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
      LogWrite <span style="color: #800000;">"Downloading $destination64 failed"</span>
      Exit
  <span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
  LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
&nbsp;
try <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Installing JDK-x64'</span>
    <span style="color: #800080;">$proc1</span> <span style="color: pink;">=</span> Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800000;">"$destination64"</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/s REBOOT=ReallySuppress"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
    <span style="color: #800080;">$proc1</span>.waitForExit<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
    LogWrite <span style="color: #800000;">'Installation Done.'</span>
&nbsp;
    LogWrite <span style="color: #800000;">'Installing JDK-x86'</span>
    <span style="color: #800080;">$proc2</span> <span style="color: pink;">=</span> Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800000;">"$destination86"</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/s REBOOT=ReallySuppress"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
    <span style="color: #800080;">$proc2</span>.waitForExit<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
    LogWrite <span style="color: #800000;">'Installtion Done.'</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'$_ is'</span> <span style="color: #000080;">$_</span>
    LogWrite <span style="color: #800000;">'$_.GetType().FullName is'</span> <span style="color: #000080;">$_</span>.GetType<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.FullName
    LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
    LogWrite <span style="color: #800000;">'$_.Exception.GetType().FullName is'</span> <span style="color: #000080;">$_</span>.Exception.GetType<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.FullName
    LogWrite <span style="color: #800000;">'$_.Exception.Message is'</span> <span style="color: #000080;">$_</span>.Exception.Message
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files (x86)\Java"</span><span style="color: #000000;">&#41;</span> <span style="color: #FF0000;">-Or</span> <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files\Java"</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Java installed successfully.'</span>
<span style="color: #000000;">&#125;</span> <span style="color: #0000FF;">else</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Java install Failed!'</span>
<span style="color: #000000;">&#125;</span>
LogWrite <span style="color: #800000;">'Setting up Path variables.'</span>
<span style="color: #000000;">&#91;</span>System.Environment<span style="color: #000000;">&#93;</span>::SetEnvironmentVariable<span style="color: #000000;">&#40;</span><span style="color: #800000;">"JAVA_HOME"</span><span style="color: pink;">,</span> <span style="color: #800000;">"c:\Program Files (x86)\Java\jdk$JDK_PATH"</span><span style="color: pink;">,</span> <span style="color: #800000;">"Machine"</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#91;</span>System.Environment<span style="color: #000000;">&#93;</span>::SetEnvironmentVariable<span style="color: #000000;">&#40;</span><span style="color: #800000;">"PATH"</span><span style="color: pink;">,</span> <span style="color: #800080;">$Env</span>:Path <span style="color: pink;">+</span> <span style="color: #800000;">";c:\Program Files (x86)\Java\jdk$JDK_PATH\bin"</span><span style="color: pink;">,</span> <span style="color: #800000;">"Machine"</span><span style="color: #000000;">&#41;</span>
LogWrite <span style="color: #800000;">'Done. Goodbye.'</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>This installs both x86 and 64 bit version of Java.</p>

<h1 id="provision">Provision</h1>

<p>I decided to put these into the provision phase to get log messages written out properly. Because in the unattended file, you can&#8217;t see any progress.</p>

<h4 id="chrome-and-firefox">Chrome And Firefox</h4>

<p>Installing these two proved a little bit more difficult. Chrome didn&#8217;t really like me to download their installer without accepting something first, like Java. Luckily, after a LOT of digging, I found a chrome installer which lets you install silently. Here is the script to install the two.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="powershell" style="font-family:monospace;"><span style="color: #0000FF;">function</span> LogWrite <span style="color: #000000;">&#123;</span>
    <span style="color: #0000FF;">Param</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span><span style="color: #008080;">string</span><span style="color: #000000;">&#93;</span><span style="color: #800080;">$logstring</span><span style="color: #000000;">&#41;</span>
    <span style="color: #800080;">$now</span> <span style="color: pink;">=</span> <span style="color: #008080; font-weight: bold;">Get-Date</span> <span style="color: #008080; font-style: italic;">-format</span> s
    <span style="color: #008080; font-weight: bold;">Add-Content</span> <span style="color: #800080;">$Logfile</span> <span style="color: #008080; font-style: italic;">-value</span> <span style="color: #800000;">"$now $logstring"</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800080;">$logstring</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #0000FF;">function</span> CheckLocation <span style="color: #000000;">&#123;</span>
    <span style="color: #0000FF;">Param</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span><span style="color: #008080;">string</span><span style="color: #000000;">&#93;</span><span style="color: #800080;">$location</span><span style="color: #000000;">&#41;</span>
    <span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span>  <span style="color: #800080;">$location</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
        <span style="color: #0000FF;">throw</span> <span style="color: #000000;">&#91;</span>System.IO.FileNotFoundException<span style="color: #000000;">&#93;</span> <span style="color: #800000;">"Could not download to Destination $location."</span>
    <span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #800080;">$Logfile</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\chrome-firefox-install.log"</span>
&nbsp;
<span style="color: #800080;">$chrome_source</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://dl.google.com/chrome/install/375.126/chrome_installer.exe"</span>
<span style="color: #800080;">$chrome_destination</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\chrome_installer.exe"</span>
<span style="color: #800080;">$firefox_source</span> <span style="color: pink;">=</span> <span style="color: #800000;">"https://download-installer.cdn.mozilla.net/pub/firefox/releases/39.0/win32/hu/Firefox%20Setup%2039.0.exe"</span>
<span style="color: #800080;">$firefox_destination</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\firefoxinstaller.exe"</span>
&nbsp;
LogWrite <span style="color: #800000;">'Starting to download files.'</span>
try <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Downloading Chrome...'</span>
    <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">New-Object</span> System.Net.WebClient<span style="color: #000000;">&#41;</span>.DownloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$chrome_source</span><span style="color: pink;">,</span> <span style="color: #800080;">$chrome_destination</span><span style="color: #000000;">&#41;</span>
    CheckLocation <span style="color: #800080;">$chrome_destination</span>
    LogWrite <span style="color: #800000;">'Done...'</span>
    LogWrite <span style="color: #800000;">'Downloading Firefox...'</span>
    <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">New-Object</span> System.Net.WebClient<span style="color: #000000;">&#41;</span>.DownloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$firefox_source</span><span style="color: pink;">,</span> <span style="color: #800080;">$firefox_destination</span><span style="color: #000000;">&#41;</span>
    CheckLocation <span style="color: #800080;">$firefox_destination</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">"Exception during download. Probable cause could be that the directory or the file didn't exist."</span>
    LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
&nbsp;
LogWrite <span style="color: #800000;">'Starting firefox install process.'</span>
try <span style="color: #000000;">&#123;</span>
    Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800080;">$firefox_destination</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"-ms"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Exception during install process.'</span>
    LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
LogWrite <span style="color: #800000;">'Starting chrome install process.'</span>
&nbsp;
try <span style="color: #000000;">&#123;</span>
    Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800080;">$chrome_destination</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/silent /install"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
    LogWrite <span style="color: #800000;">'Exception during install process.'</span>
    LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
&nbsp;
LogWrite <span style="color: #800000;">'All done. Goodbye.'</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>They both install silently. Pretty neat.</p>

<h4 id="selenium">Selenium</h4>

<p>This only has to be downloaded, so this is pretty simple. Vagrant will handle the startup of course when it does a vagrant up.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="powershell" style="font-family:monospace;"><span style="color: #0000FF;">function</span> LogWrite <span style="color: #000000;">&#123;</span>
   <span style="color: #0000FF;">Param</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span><span style="color: #008080;">string</span><span style="color: #000000;">&#93;</span><span style="color: #800080;">$logstring</span><span style="color: #000000;">&#41;</span>
   <span style="color: #800080;">$now</span> <span style="color: pink;">=</span> <span style="color: #008080; font-weight: bold;">Get-Date</span> <span style="color: #008080; font-style: italic;">-format</span> s
   <span style="color: #008080; font-weight: bold;">Add-Content</span> <span style="color: #800080;">$Logfile</span> <span style="color: #008080; font-style: italic;">-value</span> <span style="color: #800000;">"$now $logstring"</span>
   <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800080;">$logstring</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #800080;">$Logfile</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\selenium-install.log"</span>
&nbsp;
<span style="color: #800080;">$source</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://selenium-release.storage.googleapis.com/2.46/selenium-server-standalone-2.46.0.jar"</span>
<span style="color: #800080;">$destination</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\selenium-server.jar"</span>
LogWrite <span style="color: #800000;">'Starting to download selenium file.'</span>
try <span style="color: #000000;">&#123;</span>
  <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">New-Object</span> System.Net.WebClient<span style="color: #000000;">&#41;</span>.DownloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
  LogWrite <span style="color: #800000;">"Exception during download. Probable cause could be that the directory or the file didn't exist."</span>
  LogWrite <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
LogWrite <span style="color: #800000;">'Download done. Checking if file exists.'</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
  LogWrite <span style="color: #800000;">'Downloading dotnet Failed!'</span>
<span style="color: #000000;">&#125;</span> <span style="color: #0000FF;">else</span> <span style="color: #000000;">&#123;</span>
  LogWrite <span style="color: #800000;">'Download successful.'</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
LogWrite <span style="color: #800000;">'All done. Goodbye.'</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>Straightforward.</p>

<h4 id="the-packer-json-file">The Packer Json File</h4>

<p>So putting this all together, here is the Packer JSON file for this:</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="json" style="font-family:monospace;">{
      "variables": {
      "vm_name": "win7x64selenium",
      "output_dir": "output_win7_x64_selenium",
      "vagrant_box_output": "box_output",
      "cpu_number": "2",
      "memory_size": "4096",
      "machine_type": "pc-1.2",
      "accelerator": "kvm",
      "disk_format": "qcow2",
      "disk_interface": "virtio",
      "net_device": "virtio-net",
      "cpu_model": "host",
      "disk_cache": "writeback",
      "disk_io": "native"
   },
&nbsp;
  "builders": [
    {
      "type": "virtualbox-iso",
      "iso_url": "/home/user/vms/windows7.iso",
      "iso_checksum_type": "sha1",
      "iso_checksum": "0BCFC54019EA175B1EE51F6D2B207A3D14DD2B58",
      "headless": true,
      "boot_wait": "2m",
      "ssh_username": "vagrant",
      "ssh_password": "vagrant",
      "ssh_wait_timeout": "8h",
      "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
      "guest_os_type": "Windows7_64",
      "disk_size": 61440,
      "floppy_files": [
        "./answer_files/7-selenium/Autounattend.xml",
        "./scripts/dis-updates.ps1",
        "./scripts/microsoft-updates.bat",
        "./scripts/openssh.ps1",
        "./scripts/jdk_inst.ps1"
      ],
      "vboxmanage": [
        [
          "modifyvm",
          "{{.Name}}",
          "--memory",
          "{{user `memory_size`}}"
        ],
        [
          "modifyvm",
          "{{.Name}}",
          "--cpus",
          "{{user `cpu_number`}}"
        ]
      ]
    }
  ],
  "provisioners": [
    {
      "type": "powershell",
      "scripts" : [
        "./scripts/install-selenium-server.ps1",
        "./scripts/install-chrome-firefox.ps1"
      ]
    },{
      "type": "shell",
      "remote_path": "/tmp/script.bat",
      "execute_command": "{{.Vars}} cmd /c C:/Windows/Temp/script.bat",
      "scripts": [
        "./scripts/vm-guest-tools.bat",
        "./scripts/vagrant-ssh.bat",
        "./scripts/rsync.bat",
        "./scripts/enable-rdp.bat"
      ]
    }
  ],
    "post-processors": [
    {
      "type": "vagrant",
      "keep_input_artifact": false,
      "output": "{{user `vm_name`}}_{{.Provider}}.box",
      "vagrantfile_template": "vagrantfile-template"
    }
    ]
}</pre>
      </td>
    </tr>
  </table>
</div>

<h4 id="additional-software">Additional Software</h4>

<p>This is not done here. Obviously, in order to test your stuff, you first need to install your software on this box. Ideally, everything you need should be in the code you clone to this box, and should be contained mostly. And your application deployment should take core of that. But, if you require something like a DB, postgres, oracle, whatnot, than this is the place where you would install all that.</p>

<h1 id="vagrant-and-using-the-packer-box">Vagrant and Using the Packer Box</h1>

<p>Now, this has been interesting so far, but how do you actually go about using this image? That&#8217;s the real question now, isn&#8217;t it? Having a box, just sitting on a shared folder, doesn&#8217;t do you too much good. So let&#8217;s create a Jenkins job, which utilizes this box in a job which runs a bunch of tests for some application.</p>

<h4 id="vagrantfile">Vagrantfile</h4>

<p>Your vagrant file, could either be generated automatically, under source control ( which is preferred ) or sitting somewhere entirely elsewhere. In any case, it would look something like this.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="ruby" style="font-family:monospace;"><span style="color:#008000; font-style:italic;"># -*- mode: ruby -*-</span>
<span style="color:#008000; font-style:italic;"># vi: set ft=ruby :</span>
&nbsp;
VAGRANTFILE_API_VERSION = <span style="color:#996600;">"2"</span>
&nbsp;
Vagrant.<span style="color:#9900CC;">configure</span><span style="color:#006600; font-weight:bold;">&#40;</span>VAGRANTFILE_API_VERSION<span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>config<span style="color:#006600; font-weight:bold;">|</span>
&nbsp;
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provider</span> <span style="color:#996600;">"virtualbox"</span>
&nbsp;
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">define</span> <span style="color:#996600;">"selenium-box"</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>vs2013<span style="color:#006600; font-weight:bold;">|</span>
    vs2013.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">box</span> = <span style="color:#996600;">"windows7-x64-04-selenium"</span>
    vs2013.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">box_url</span> = <span style="color:#996600;">"path/to/your/share/win7x64_selenium_virtualbox.box"</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
  config.<span style="color:#9900CC;">env</span>.<span style="color:#9900CC;">enable</span>
&nbsp;
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">guest</span> = <span style="color:#ff3333; font-weight:bold;">:windows</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">communicator</span> = <span style="color:#996600;">"winrm"</span>
  config.<span style="color:#9900CC;">winrm</span>.<span style="color:#9900CC;">username</span> = <span style="color:#996600;">"vagrant"</span>
  config.<span style="color:#9900CC;">winrm</span>.<span style="color:#9900CC;">password</span> = <span style="color:#996600;">"vagrant"</span>
  config.<span style="color:#9900CC;">windows</span>.<span style="color:#9900CC;">set_work_network</span> = <span style="color:#0000FF; font-weight:bold;">true</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">network</span> <span style="color:#ff3333; font-weight:bold;">:forwarded_port</span>, guest: <span style="color:#006666;">3389</span>, host: ENV<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">'RDESKTOP_PORT'</span><span style="color:#006600; font-weight:bold;">&#93;</span>, host_ip: <span style="color:#996600;">"0.0.0.0"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">network</span> <span style="color:#ff3333; font-weight:bold;">:forwarded_port</span>, guest: <span style="color:#006666;">5985</span>, host: <span style="color:#006666;">5985</span>, id: <span style="color:#996600;">"winrm"</span>, auto_correct: <span style="color:#0000FF; font-weight:bold;">true</span>, host_ip: <span style="color:#996600;">"0.0.0.0"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">network</span> <span style="color:#ff3333; font-weight:bold;">:forwarded_port</span>, guest: <span style="color:#006666;">9991</span>, host: <span style="color:#006666;">9991</span>, id: <span style="color:#996600;">"selenium"</span>, auto_correct: <span style="color:#0000FF; font-weight:bold;">true</span>, host_ip: <span style="color:#996600;">"0.0.0.0"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provider</span> <span style="color:#ff3333; font-weight:bold;">:virtualbox</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>vbox<span style="color:#006600; font-weight:bold;">|</span>
    vbox.<span style="color:#9900CC;">gui</span> = <span style="color:#0000FF; font-weight:bold;">false</span>
    vbox.<span style="color:#9900CC;">memory</span> = <span style="color:#006666;">4096</span>
    vbox.<span style="color:#9900CC;">cpus</span> = <span style="color:#006666;">2</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
&nbsp;
  config.<span style="color:#9900CC;">winrm</span>.<span style="color:#9900CC;">max_tries</span> = <span style="color:#006666;">10</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">synced_folder</span> <span style="color:#996600;">"."</span>, <span style="color:#996600;">"/vagrant"</span>, type: <span style="color:#996600;">"rsync"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provision</span> <span style="color:#996600;">"shell"</span>, path: <span style="color:#996600;">"init.bat"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provision</span> <span style="color:#996600;">"shell"</span>, path: <span style="color:#996600;">"utils_inst.bat"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provision</span> <span style="color:#996600;">"shell"</span>, path: <span style="color:#996600;">"jenkins_reg.ps1"</span>
  config.<span style="color:#9900CC;">vm</span>.<span style="color:#9900CC;">provision</span> <span style="color:#996600;">"shell"</span>, path: <span style="color:#996600;">"start_selenium.bat"</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>Easy, no? Here is the script to start selenium.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="batch" style="font-family:monospace;">    java -jar c:\Windows\Temp\selenium-server.jar -Dhttp.proxyPort=9991</pre>
      </td>
    </tr>
  </table>
</div>

<p>Straight forward. We also are forwarding the port on which Selenium is running in order for the test to see it.</p>

<h4 id="the-jenkins-job">The Jenkins Job</h4>

<p>The job can be anything. This is actually too large to cover here. It could be a gradle job, a maven job, an ant, a nant &#8211; or whatever is running the test -, job; it&#8217;s up to you.</p>

<p>Just make sure that before the test runs, do a <strong>vagrant up</strong> and after the test finishes, in an ALWAYS TO BE EXECUTED HOOK -like gradle&#8217;s finalizedBy , call a <strong>vagrant destroy</strong>. This way, your test will always run on a clean instance that has the necessary stuff on it.</p>

<h1 id="closing-words">Closing words</h1>

<p>So, there you have it. It&#8217;s relatively simple. Tying this all into your infrastructure might prove difficult though depending on how rigid your deployment is. But it will always help you make your tests a bit more robust.</p>

<p>Also, you could run the whole deployment and test phase on a vagrant box, from the start, which is tied to jenkins as a slave and gets started when the job starts and destroyed when the job ends. That way you wouldn&#8217;t have to create a, box in a box running on a box, kind of effect.</p>

<p>Thanks for reading,</p>

<p>Gergely.</p>
                    </div>
                </section>
                
                <h1 class="content-subhead">01 Jul 2015, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2015/07/01/packer-0-8-1/" class="post-title">Packer 0.8.1.</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-devops" href="https://skarlso.github.io//categories/devops">devops</a><a class="post-category post-category-problem solving" href="https://skarlso.github.io//categories/problem-solving">problem solving</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Previously I wrote that the scripts I&#8217;m writing, are failing because Packer hangs.</p>

<p>Apparently, this was a known issue. And apparently, I was using an older version, 0.7.5. After I updated everything is working wonderfully!!!</p>

<p>And for my thanks, here is an updated PowerShell script for provisioning my dotnet stuff.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="powershell" style="font-family:monospace;"><span style="color: #800080;">$source</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://download.microsoft.com/download/1/6/7/167F0D79-9317-48AE-AEDB-17120579F8E2/NDP451-KB2858728-x86-x64-AllOS-ENU.exe"</span>
<span style="color: #800080;">$destination</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\dotnet.exe"</span>
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Starting to download dotnet file.'</span>
try <span style="color: #000000;">&#123;</span>
  <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">New-Object</span> System.Net.WebClient<span style="color: #000000;">&#41;</span>.DownloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">"Exception during download. Probable cause could be that the directory or the file didn't exist."</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Download done. Checking if file exists.'</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Downloading dotnet Failed!'</span>
<span style="color: #000000;">&#125;</span> <span style="color: #0000FF;">else</span> <span style="color: #000000;">&#123;</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Download successful.'</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Starting install process.'</span>
try <span style="color: #000000;">&#123;</span>
  Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800080;">$source</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/q /norestart"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Exception during install process.'</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'All done. Goodbye.'</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>Thanks for reading!</p>

<p>Gergely.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">01 Jul 2015, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2015/07/01/packer-0-8-1/" class="post-title">Packer 0.8.1.</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-devops" href="https://skarlso.github.io//categories/devops">devops</a><a class="post-category post-category-problem solving" href="https://skarlso.github.io//categories/problem-solving">problem solving</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Previously I wrote that the scripts I&#8217;m writing, are failing because Packer hangs.</p>

<p>Apparently, this was a known issue. And apparently, I was using an older version, 0.7.5. After I updated everything is working wonderfully!!!</p>

<p>And for my thanks, here is an updated PowerShell script for provisioning my dotnet stuff.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="powershell" style="font-family:monospace;"><span style="color: #800080;">$source</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://download.microsoft.com/download/1/6/7/167F0D79-9317-48AE-AEDB-17120579F8E2/NDP451-KB2858728-x86-x64-AllOS-ENU.exe"</span>
<span style="color: #800080;">$destination</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\Windows\Temp\dotnet.exe"</span>
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Starting to download dotnet file.'</span>
try <span style="color: #000000;">&#123;</span>
  <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">New-Object</span> System.Net.WebClient<span style="color: #000000;">&#41;</span>.DownloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">"Exception during download. Probable cause could be that the directory or the file didn't exist."</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Download done. Checking if file exists.'</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Downloading dotnet Failed!'</span>
<span style="color: #000000;">&#125;</span> <span style="color: #0000FF;">else</span> <span style="color: #000000;">&#123;</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Download successful.'</span>
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Starting install process.'</span>
try <span style="color: #000000;">&#123;</span>
  Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800080;">$source</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/q /norestart"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>Exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Exception during install process.'</span>
  <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'All done. Goodbye.'</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>Thanks for reading!</p>

<p>Gergely.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">30 Jun 2015, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2015/06/30/powershell-can-also-be-nice-or-installing-java-silently-and-waiting/" class="post-title">Powershell can also be nice -Or Installing Java silently and waiting</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-devops" href="https://skarlso.github.io//categories/devops">devops</a><a class="post-category post-category-problem solving" href="https://skarlso.github.io//categories/problem-solving">problem solving</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Hello folks.</p>

<p>Today, I would like to show you a small script. It installs Java JDK, both version, x86 and 64 bit, silently, and wait for that process to finish.</p>

<p>The wait is necessary because /s on a java install has the nasty habit of running in the background. If you are using a .bat file, <strong>you shouldn&#8217;t</strong>, than you would use something like: start /w jdk-setup.exe /s. This gets it done, but is ugly. Also, if you are using Packer and PowerShell provisioning, you might want to set up some environment variables as well for the next script. And you want that property to be available and you don&#8217;t want to mess it up with setting a path into a file and then re-setting your path on the begin of your other script. Or pass it around with Packer. No. Use a proper PowerShell script. Learn it. It&#8217;s not that hard. Be a professional. Don&#8217;t hack something together for the next person to suffer at.</p>

<p>Here is how I did it. Hope it helps somebody out.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="powershell" style="font-family:monospace;"><span style="color: #800080;">$JDK_VER</span><span style="color: pink;">=</span><span style="color: #800000;">"7u75"</span>
<span style="color: #800080;">$JDK_FULL_VER</span><span style="color: pink;">=</span><span style="color: #800000;">"7u75-b13"</span>
<span style="color: #800080;">$JDK_PATH</span><span style="color: pink;">=</span><span style="color: #800000;">"1.7.0_75"</span>
<span style="color: #800080;">$source86</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://download.oracle.com/otn-pub/java/jdk/$JDK_FULL_VER/jdk-$JDK_VER-windows-i586.exe"</span>
<span style="color: #800080;">$source64</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://download.oracle.com/otn-pub/java/jdk/$JDK_FULL_VER/jdk-$JDK_VER-windows-x64.exe"</span>
<span style="color: #800080;">$destination86</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\vagrant\$JDK_VER-x86.exe"</span>
<span style="color: #800080;">$destination64</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\vagrant\$JDK_VER-x64.exe"</span>
<span style="color: #800080;">$client</span> <span style="color: pink;">=</span> <span style="color: #008080; font-weight: bold;">new-object</span> System.Net.WebClient
<span style="color: #800080;">$cookie</span> <span style="color: pink;">=</span> <span style="color: #800000;">"oraclelicense=accept-securebackup-cookie"</span>
<span style="color: #800080;">$client</span>.Headers.Add<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>System.Net.HttpRequestHeader<span style="color: #000000;">&#93;</span>::Cookie<span style="color: pink;">,</span> <span style="color: #800080;">$cookie</span><span style="color: #000000;">&#41;</span>
&nbsp;
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Checking if Java is already installed'</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files (x86)\Java"</span><span style="color: #000000;">&#41;</span> <span style="color: #FF0000;">-Or</span> <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files\Java"</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'No need to Install Java'</span>
    Exit
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Downloading x86 to $destination86'</span>
&nbsp;
<span style="color: #800080;">$client</span>.downloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source86</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination86</span><span style="color: #000000;">&#41;</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination86</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">"Downloading $destination86 failed"</span>
    Exit
<span style="color: #000000;">&#125;</span>
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Downloading x64 to $destination64'</span>
&nbsp;
<span style="color: #800080;">$client</span>.downloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source64</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination64</span><span style="color: #000000;">&#41;</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination64</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">"Downloading $destination64 failed"</span>
    Exit
<span style="color: #000000;">&#125;</span>
&nbsp;
&nbsp;
try <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Installing JDK-x64'</span>
    <span style="color: #800080;">$proc1</span> <span style="color: pink;">=</span> Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800000;">"$destination64"</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/s REBOOT=ReallySuppress"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
    <span style="color: #800080;">$proc1</span>.waitForExit<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Installation Done.'</span>
&nbsp;
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Installing JDK-x86'</span>
    <span style="color: #800080;">$proc2</span> <span style="color: pink;">=</span> Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800000;">"$destination86"</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/s REBOOT=ReallySuppress"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
    <span style="color: #800080;">$proc2</span>.waitForExit<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Installtion Done.'</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">write-host</span> <span style="color: #800000;">'$_ is'</span> <span style="color: #000080;">$_</span>
    <span style="color: #008080; font-weight: bold;">write-host</span> <span style="color: #800000;">'$_.GetType().FullName is'</span> <span style="color: #000080;">$_</span>.GetType<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.FullName
    <span style="color: #008080; font-weight: bold;">write-host</span> <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
    <span style="color: #008080; font-weight: bold;">write-host</span> <span style="color: #800000;">'$_.Exception.GetType().FullName is'</span> <span style="color: #000080;">$_</span>.Exception.GetType<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.FullName
    <span style="color: #008080; font-weight: bold;">write-host</span> <span style="color: #800000;">'$_.Exception.Message is'</span> <span style="color: #000080;">$_</span>.Exception.Message
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files (x86)\Java"</span><span style="color: #000000;">&#41;</span> <span style="color: #FF0000;">-Or</span> <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files\Java"</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Java installed successfully.'</span>
<span style="color: #000000;">&#125;</span>
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Setting up Path variables.'</span>
<span style="color: #000000;">&#91;</span>System.Environment<span style="color: #000000;">&#93;</span>::SetEnvironmentVariable<span style="color: #000000;">&#40;</span><span style="color: #800000;">"JAVA_HOME"</span><span style="color: pink;">,</span> <span style="color: #800000;">"c:\Program Files (x86)\Java\jdk$JDK_PATH"</span><span style="color: pink;">,</span> <span style="color: #800000;">"Machine"</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#91;</span>System.Environment<span style="color: #000000;">&#93;</span>::SetEnvironmentVariable<span style="color: #000000;">&#40;</span><span style="color: #800000;">"PATH"</span><span style="color: pink;">,</span> <span style="color: #800080;">$Env</span>:Path <span style="color: pink;">+</span> <span style="color: #800000;">";c:\Program Files (x86)\Java\jdk$JDK_PATH\bin"</span><span style="color: pink;">,</span> <span style="color: #800000;">"Machine"</span><span style="color: #000000;">&#41;</span>
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Done. Goodbye.'</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>Now, there is room for improvement here. Like checking exit code, doing something extra after a failed exit. Throwing an exception, and so on and so forth. But this is a much needed improvement from calling a BAT file.</p>

<p>And you would use this in a Packer JSON file like this..</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="json" style="font-family:monospace;">{
      "type": "powershell",
      "scripts": [
        "./scripts/jdk_inst.ps1"
      ]
}</pre>
      </td>
    </tr>
  </table>
</div>

<p>Easy. And at the end, the System.Environment actually writes out into the registry permanently so no need to pass it around in a file or something ugly like that.</p>

<p>Hope this helps somebody.</p>

<p>Thanks for reading.</p>

<p>Gergely.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">30 Jun 2015, 00:00</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2015/06/30/powershell-can-also-be-nice-or-installing-java-silently-and-waiting/" class="post-title">Powershell can also be nice -Or Installing Java silently and waiting</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-devops" href="https://skarlso.github.io//categories/devops">devops</a><a class="post-category post-category-problem solving" href="https://skarlso.github.io//categories/problem-solving">problem solving</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Hello folks.</p>

<p>Today, I would like to show you a small script. It installs Java JDK, both version, x86 and 64 bit, silently, and wait for that process to finish.</p>

<p>The wait is necessary because /s on a java install has the nasty habit of running in the background. If you are using a .bat file, <strong>you shouldn&#8217;t</strong>, than you would use something like: start /w jdk-setup.exe /s. This gets it done, but is ugly. Also, if you are using Packer and PowerShell provisioning, you might want to set up some environment variables as well for the next script. And you want that property to be available and you don&#8217;t want to mess it up with setting a path into a file and then re-setting your path on the begin of your other script. Or pass it around with Packer. No. Use a proper PowerShell script. Learn it. It&#8217;s not that hard. Be a professional. Don&#8217;t hack something together for the next person to suffer at.</p>

<p>Here is how I did it. Hope it helps somebody out.</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="powershell" style="font-family:monospace;"><span style="color: #800080;">$JDK_VER</span><span style="color: pink;">=</span><span style="color: #800000;">"7u75"</span>
<span style="color: #800080;">$JDK_FULL_VER</span><span style="color: pink;">=</span><span style="color: #800000;">"7u75-b13"</span>
<span style="color: #800080;">$JDK_PATH</span><span style="color: pink;">=</span><span style="color: #800000;">"1.7.0_75"</span>
<span style="color: #800080;">$source86</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://download.oracle.com/otn-pub/java/jdk/$JDK_FULL_VER/jdk-$JDK_VER-windows-i586.exe"</span>
<span style="color: #800080;">$source64</span> <span style="color: pink;">=</span> <span style="color: #800000;">"http://download.oracle.com/otn-pub/java/jdk/$JDK_FULL_VER/jdk-$JDK_VER-windows-x64.exe"</span>
<span style="color: #800080;">$destination86</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\vagrant\$JDK_VER-x86.exe"</span>
<span style="color: #800080;">$destination64</span> <span style="color: pink;">=</span> <span style="color: #800000;">"C:\vagrant\$JDK_VER-x64.exe"</span>
<span style="color: #800080;">$client</span> <span style="color: pink;">=</span> <span style="color: #008080; font-weight: bold;">new-object</span> System.Net.WebClient
<span style="color: #800080;">$cookie</span> <span style="color: pink;">=</span> <span style="color: #800000;">"oraclelicense=accept-securebackup-cookie"</span>
<span style="color: #800080;">$client</span>.Headers.Add<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>System.Net.HttpRequestHeader<span style="color: #000000;">&#93;</span>::Cookie<span style="color: pink;">,</span> <span style="color: #800080;">$cookie</span><span style="color: #000000;">&#41;</span>
&nbsp;
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Checking if Java is already installed'</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files (x86)\Java"</span><span style="color: #000000;">&#41;</span> <span style="color: #FF0000;">-Or</span> <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files\Java"</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'No need to Install Java'</span>
    Exit
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Downloading x86 to $destination86'</span>
&nbsp;
<span style="color: #800080;">$client</span>.downloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source86</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination86</span><span style="color: #000000;">&#41;</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination86</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">"Downloading $destination86 failed"</span>
    Exit
<span style="color: #000000;">&#125;</span>
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Downloading x64 to $destination64'</span>
&nbsp;
<span style="color: #800080;">$client</span>.downloadFile<span style="color: #000000;">&#40;</span><span style="color: #800080;">$source64</span><span style="color: pink;">,</span> <span style="color: #800080;">$destination64</span><span style="color: #000000;">&#41;</span>
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: pink;">!</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800080;">$destination64</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">"Downloading $destination64 failed"</span>
    Exit
<span style="color: #000000;">&#125;</span>
&nbsp;
&nbsp;
try <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Installing JDK-x64'</span>
    <span style="color: #800080;">$proc1</span> <span style="color: pink;">=</span> Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800000;">"$destination64"</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/s REBOOT=ReallySuppress"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
    <span style="color: #800080;">$proc1</span>.waitForExit<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Installation Done.'</span>
&nbsp;
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Installing JDK-x86'</span>
    <span style="color: #800080;">$proc2</span> <span style="color: pink;">=</span> Start<span style="color: pink;">-</span>Process <span style="color: #008080; font-style: italic;">-FilePath</span> <span style="color: #800000;">"$destination86"</span> <span style="color: #008080; font-style: italic;">-ArgumentList</span> <span style="color: #800000;">"/s REBOOT=ReallySuppress"</span> <span style="color: #008080; font-style: italic;">-Wait</span> <span style="color: #008080; font-style: italic;">-PassThru</span>
    <span style="color: #800080;">$proc2</span>.waitForExit<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Installtion Done.'</span>
<span style="color: #000000;">&#125;</span> catch <span style="color: #000000;">&#91;</span>exception<span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">write-host</span> <span style="color: #800000;">'$_ is'</span> <span style="color: #000080;">$_</span>
    <span style="color: #008080; font-weight: bold;">write-host</span> <span style="color: #800000;">'$_.GetType().FullName is'</span> <span style="color: #000080;">$_</span>.GetType<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.FullName
    <span style="color: #008080; font-weight: bold;">write-host</span> <span style="color: #800000;">'$_.Exception is'</span> <span style="color: #000080;">$_</span>.Exception
    <span style="color: #008080; font-weight: bold;">write-host</span> <span style="color: #800000;">'$_.Exception.GetType().FullName is'</span> <span style="color: #000080;">$_</span>.Exception.GetType<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>.FullName
    <span style="color: #008080; font-weight: bold;">write-host</span> <span style="color: #800000;">'$_.Exception.Message is'</span> <span style="color: #000080;">$_</span>.Exception.Message
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #0000FF;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files (x86)\Java"</span><span style="color: #000000;">&#41;</span> <span style="color: #FF0000;">-Or</span> <span style="color: #000000;">&#40;</span><span style="color: #008080; font-weight: bold;">Test-Path</span> <span style="color: #800000;">"c:\Program Files\Java"</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
    <span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Java installed successfully.'</span>
<span style="color: #000000;">&#125;</span>
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Setting up Path variables.'</span>
<span style="color: #000000;">&#91;</span>System.Environment<span style="color: #000000;">&#93;</span>::SetEnvironmentVariable<span style="color: #000000;">&#40;</span><span style="color: #800000;">"JAVA_HOME"</span><span style="color: pink;">,</span> <span style="color: #800000;">"c:\Program Files (x86)\Java\jdk$JDK_PATH"</span><span style="color: pink;">,</span> <span style="color: #800000;">"Machine"</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#91;</span>System.Environment<span style="color: #000000;">&#93;</span>::SetEnvironmentVariable<span style="color: #000000;">&#40;</span><span style="color: #800000;">"PATH"</span><span style="color: pink;">,</span> <span style="color: #800080;">$Env</span>:Path <span style="color: pink;">+</span> <span style="color: #800000;">";c:\Program Files (x86)\Java\jdk$JDK_PATH\bin"</span><span style="color: pink;">,</span> <span style="color: #800000;">"Machine"</span><span style="color: #000000;">&#41;</span>
<span style="color: #008080; font-weight: bold;">Write-Host</span> <span style="color: #800000;">'Done. Goodbye.'</span></pre>
      </td>
    </tr>
  </table>
</div>

<p>Now, there is room for improvement here. Like checking exit code, doing something extra after a failed exit. Throwing an exception, and so on and so forth. But this is a much needed improvement from calling a BAT file.</p>

<p>And you would use this in a Packer JSON file like this..</p>

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="json" style="font-family:monospace;">{
      "type": "powershell",
      "scripts": [
        "./scripts/jdk_inst.ps1"
      ]
}</pre>
      </td>
    </tr>
  </table>
</div>

<p>Easy. And at the end, the System.Environment actually writes out into the registry permanently so no need to pass it around in a file or something ugly like that.</p>

<p>Hope this helps somebody.</p>

<p>Thanks for reading.</p>

<p>Gergely.</p>

                    </div>
                </section>
                
            </div>
            
<div class="pagination">
  <nav role="pagination" class="post-list-pagination">
      
      <a href="https://skarlso.github.io/categories/problem-solving/" class="post-list-pagination-item pure-button post-list-pagination-item-prev">
        <i class="fa fa-angle-double-left"></i>&nbsp;Newer
      </a>
      
    <span class="post-list-pagination-item post-list-pagination-item-current">Page 2 of 5</span>
    
      <a href="https://skarlso.github.io/categories/problem-solving/page/3/" class="post-list-pagination-item pure-button post-list-pagination-item-next">
        Older&nbsp;<i class="fa fa-angle-double-right"></i>
      </a>
    
  </nav>
</div>


            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="https://skarlso.github.io//js/all.min.js"></script>

        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
