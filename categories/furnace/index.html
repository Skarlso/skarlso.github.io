<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Furnace &middot; Ramblings of a build engineer</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.40.3" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Furnace &middot; Ramblings of a build engineer">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Furnace &middot; Ramblings of a build engineer">
    <meta property="og:description" content="">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

    <link rel="stylesheet" href="https://skarlso.github.io//css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Ramblings of a build engineer" href="https://skarlso.github.io//index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://skarlso.github.io/">Ramblings of a build engineer</a></h1>
            <h2 class="brand-tagline"></h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/Skarlso"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/Skarlso "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://linkedin.com/in/brautigamgergely "><i class="fa fa-linkedin-alt"></i> LinkedIn</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="https://skarlso.github.io//index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
                <li class="nav-item">
                    <link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">
                    <a class="pure-button" target="_blank" href="https://www.buymeacoffee.com/skarlso">
                        <img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me a coffee">
                        Buy me a coffee
                    </a>
                </li>
                <div style="overflow-y: scroll; height:250px;" align="left">
                    
                        <a href="https://skarlso.github.io/2018/01/13/furnace-massive-update/">Huge Furnace Update</a></br>
                    
                        <a href="https://skarlso.github.io/2017/11/06/furnace-ikea-manual/">Furnace Ikea Manual</a></br>
                    
                        <a href="https://skarlso.github.io/2017/09/03/furnace-binaries/">Furnace Binaries</a></br>
                    
                </div>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">13 Jan 2018, 22:34</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2018/01/13/furnace-massive-update/" class="post-title">Huge Furnace Update</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-AWS" href="https://skarlso.github.io//categories/aws">AWS</a><a class="post-category post-category-Go" href="https://skarlso.github.io//categories/go">Go</a><a class="post-category post-category-Furnace" href="https://skarlso.github.io//categories/furnace">Furnace</a><a class="post-category post-category-GCP" href="https://skarlso.github.io//categories/gcp">GCP</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        

<h1 id="intro">Intro</h1>

<p>Hi folks.</p>

<p>In the past couple of months I&rsquo;ve been slowly updating <a href="https://github.com/Skarlso/go-furnace">Furnace</a>.</p>

<p>There are three major changes that happened. Let&rsquo;s take a look at them, shall we?</p>

<h2 id="google-cloud-platform">Google Cloud Platform</h2>

<p>Furnace now supports <a href="https://cloud.google.com">Google Cloud Platform (GCP)</a>. It provides the same API to handle GCP resource as with AWS. Namely, <code>create</code>, <code>delete</code>, <code>status</code>, <code>update</code>. I opted to leave out <code>push</code> because Google mostly works with git based repositories, meaning a push is literary just a push, than Google handles distributing the new code by itself.</p>

<p>All the rest of the commands should work the same way as AWS.</p>

<h3 id="deployment-manager">Deployment Manager</h3>

<p>GCP has a similar service to AWS CloudFormations called <a href="https://cloud.google.com/deployment-manager/docs/">Deployment Manager</a>. The documentation is fairly detailed with a Bookshelf example app to deploy. Code and Templates can be found in their Git repositroy here: <a href="https://github.com/GoogleCloudPlatform/deploymentmanager-samples">Deployment Manager Git Repository</a>.</p>

<h3 id="setting-up-gcp">Setting up GCP</h3>

<p>As the README of Furnace outlines&hellip;</p>

<blockquote>
<p>Please carefully read and follow the instruction outlined in this document: <a href="https://cloud.google.com/sdk/#Quick_Start">Google Cloud Getting Started</a>. It will describe how to download and install the SDK and initialize cloud to a Project ID.</p>

<p>Take special attention to these documents:</p>

<p><a href="https://cloud.google.com/sdk/docs/initializing">Initializing GCloud Tools</a>
<a href="https://cloud.google.com/sdk/docs/authorizing">Authorizing Tools</a></p>

<p>Furnace uses a Google Key-File to authenticate with your Google Cloud Account and Project.
In the future, Furnace assumes these things are properly set up and in working order.</p>
</blockquote>

<p>To initialize the client, it uses the following code:</p>

<pre><code class="language-go">  ctx := context.Background()
  client, err := google.DefaultClient(ctx, dm.NdevCloudmanScope)
</code></pre>

<p>The DefaultClient in turn, does the following:</p>

<pre><code class="language-go">// FindDefaultCredentials searches for &quot;Application Default Credentials&quot;.
//
// It looks for credentials in the following places,
// preferring the first location found:
//
//   1. A JSON file whose path is specified by the
//      GOOGLE_APPLICATION_CREDENTIALS environment variable.
//   2. A JSON file in a location known to the gcloud command-line tool.
//      On Windows, this is %APPDATA%/gcloud/application_default_credentials.json.
//      On other systems, $HOME/.config/gcloud/application_default_credentials.json.
//   3. On Google App Engine it uses the appengine.AccessToken function.
//   4. On Google Compute Engine and Google App Engine Managed VMs, it fetches
//      credentials from the metadata server.
//      (In this final case any provided scopes are ignored.)
func FindDefaultCredentials(ctx context.Context, scope ...string) (*DefaultCredentials, error) {
</code></pre>

<p>Take note on the order. This is how Google will authenticate your requests.</p>

<h3 id="running-gcp">Running GCP</h3>

<p>Running gcp is largely similar to AWS. First, you create the necessary templates to your infrastructure. This is done via the Deployment Manager and it&rsquo;s templating engine. The GCP templates are Python <a href="http://jinja.pocoo.org/">JINJA</a> files. Examples are provided in the <code>template</code> directory. It&rsquo;s a bit more complicated than the CloudFormation templates in that it uses outside templates plus schema files to configure dynamic details.</p>

<p>It&rsquo;s all explained in these documents: <a href="https://cloud.google.com/deployment-manager/docs/step-by-step-guide/create-a-template">Creating a Template Step-by-step</a> and <a href="https://cloud.google.com/deployment-manager/docs/configuration/templates/create-basic-template">Creating a Basic Template</a>.</p>

<p>It&rsquo;s not trivial however. And using the API can also be confusing. The Google Code is just a generated Go code file using gRPC. But studying it may provide valuable insigth into how the API is structured. I&rsquo;m also providing some basic samples that I gathered together and the readme does a bit more explaining on how to use them.</p>

<h3 id="your-first-stack">Your First Stack</h3>

<p>Once you have everything set-up you&rsquo;ll need a configuration file for Furnace. The usage is outlined more here <a href="#YAML-Configuration">YAML Configuration</a>. The configuration file for GCP looks like this:</p>

<pre><code class="language-yaml">main:
  project_name: testplatform-1234
  spinner: 1
gcp:
  template_name: google_template.yaml
  stack_name: test-stack

</code></pre>

<p>Where <code>project_name</code> is the name you generate for your first billable Google Cloud Platform project. Template lives next to this yaml file and stack name must be DNS complient.</p>

<p>Once you have a project and a template setup, it&rsquo;s as simple as calling <code>./furnace-gcp create</code> or <code>./furnace-gcp create mycustomstack</code>.</p>

<h3 id="deleting">Deleting</h3>

<p>Deleting happens with <code>./furnace-gcp delete</code> or <code>./furnace-gcp delete mycustomstack</code>. Luckily, as with AWS, this means that every resource created with the DeploymentManager will be deleted leaving no need for search and cleanup.</p>

<h3 id="project-name-vs-project-id">Project Name vs. Project ID</h3>

<p>Unlike with AWS Google requires your stack name and project id to be DNS complient. This is most likely because all API calls and such contain that information.</p>

<h2 id="separate-binaries">Separate Binaries</h2>

<p>In order to mitigate some of Furnace&rsquo;s size, I&rsquo;m providing separate binaries for each service it supports.</p>

<p>The AWS binaries can be found in <code>aws</code> folder, and respectively, the Google Cloud Platform is located in <code>gcp</code>. Both are build-able by running <code>make</code>.</p>

<p>If you would like to run both with a single command, a top level make file is provided for your convinience. Just run <code>make</code> from the root. That will build all binaries. Later on, Digital Oceans will join the ranks.</p>

<h2 id="yaml-configuration">YAML Configuration</h2>

<p>Last but not least, Furnace now employs YAML files for configuration. However, it isn&rsquo;t JUST using YAML files. It also employs a smart configuration pattern which works as follows.</p>

<p>Since Furnace is a distributed binary file which could be running from any given location at any time. Because of that, at first I opted for a global configuration directory.</p>

<p>Now, however, furnace uses a furnace configuration file named with the following pattern: <code>.stackalias.furnace</code>. Where stackname, or stack is the name of a custom stack you would like to create for a project. The content of this file is a single entry, which is the location, relative to this file, of the YAML configuration files for the given stack. For example:</p>

<pre><code class="language-bash">stacks/mydatabasestack.yaml
</code></pre>

<p>This means, that in the directory called <code>stacks</code> there will a yaml configuration file for your database stack. The AWS config file looks like this:</p>

<pre><code class="language-YAML">main:
  stackname: FurnaceStack
  spinner: 1
aws:
  code_deploy_role: CodeDeployServiceRole
  region: us-east-1
  enable_plugin_system: false
  template_name: cloud_formation.template
  app_name: furnace_app
  code_deploy:
    # Only needed in case S3 is used for code deployment
    code_deploy_s3_bucket: furnace_code_bucket
    # The name of the zip file in case it's on a bucket
    code_deploy_s3_key: furnace_deploy_app
    # In case a Git Repository is used for the application, define these two settings
    git_account: Skarlso/furnace-codedeploy-app
    git_revision: b89451234...

</code></pre>

<p>The important part is the <code>template_name</code>. The template has to be next to this yaml file. To use this file, you simply call any of the AWS or GCP commands with an extra, optional parameter like this:</p>

<pre><code class="language-bash">./furnace-aws create mydatabase
</code></pre>

<p>Note that mydatabase will translate to <code>.mydatabase.furnace</code>.</p>

<p>The intelligent part is, that this file could be placed anywhere in the project folder structure; because furnace, when looking for a config file, traverses backwards from the current execution directory up until <code>/</code>. Where root is not included in the search.</p>

<p>Consider the following directory tree:</p>

<p>├── docs<br />
│   ├── <code>furnace-aws status mydatabase</code><br />
├── stacks<br />
│   ├── mystack.template<br />
│   └── mystack.yaml<br />
└── .mydatabase.furnace</p>

<p>You are currently in your <code>docs</code> directory and would like to ask for the status of your database. You don&rsquo;t have to move to the location of the setting file, just simply run the command from where you are. This only works if you are above the location of the file. If you would be below, furnace would say it can&rsquo;t find the file. Because it only traverses upwards.</p>

<p><code>.mydatabase.furnace</code> here contains only a single entry <code>stacks/mystack.yaml</code>. And that&rsquo;s it. This way, you could have multiple furnace files, for example a <code>.database.furnace</code>, <code>.front-end.furnace</code> and a <code>.backend.furnace</code>. All three would work in unison, and if want needs updating, simply run <code>./furnace-aws update backend</code>. And done!</p>

<h1 id="closing-words">Closing words</h1>

<p>As always, contributions are welcomed in the form of issues or pull requests. Questions anything, I tend to answer as soon as I can.</p>

<p>Always run the tests before submitting.</p>

<p>Thank you for reading.
Gergely.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">06 Nov 2017, 20:34</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2017/11/06/furnace-ikea-manual/" class="post-title">Furnace Ikea Manual</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Furnace" href="https://skarlso.github.io//categories/furnace">Furnace</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Hi there folks.</p>

<p>Just a quick post, of how I went on and created an IKEA manual about <a href="https://github.com/Skarlso/go-furnace">Furnace</a>.</p>

<p>Page 1: <img src="https://skarlso.github.io/img/ikea-furnace-1.png" alt="Page 1" />.
Page 2: <img src="https://skarlso.github.io/img/ikea-furnace-2.png" alt="Page 2" />.</p>

<p>I drew these using <a href="https://krita.org/en/">Krita</a>. I mostly used a mouse but I also used a Wacom Bamboo drawing tabled, for sketches and such.</p>

<p>Thanks,
Gergely.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">03 Sep 2017, 10:34</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://skarlso.github.io/2017/09/03/furnace-binaries/" class="post-title">Furnace Binaries</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">hannibal</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Go" href="https://skarlso.github.io//categories/go">Go</a><a class="post-category post-category-Furnace" href="https://skarlso.github.io//categories/furnace">Furnace</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Hey folks.</p>

<p>Quick note. Furnace now comes pre-compiled easy to access binaries which you can download and use out of the box.</p>

<p>No need to install anything, or compile the source. Just download, unzip and use.</p>

<p>Here is the website: <a href="https://skarlso.github.io/furnace-web">Furnace Website</a>.</p>

<p>Enjoy,
Cheers,
Gergely.</p>

                    </div>
                </section>
                
            </div>
            

            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="https://skarlso.github.io//js/all.min.js"></script>

        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-69463020-2', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
