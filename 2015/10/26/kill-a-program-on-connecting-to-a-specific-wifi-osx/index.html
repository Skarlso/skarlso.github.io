<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Kill a Program on Connecting to a specific WiFi – OSX | Ramblings of a cloud engineer</title>
<meta name="keywords" content="launchd, osx">
<meta name="description" content="Hi folks.
If you have the tendency, like me, to forget that you are on the corporate VPN, or leave a certain software open when you bring your laptop to work, this might be helpful to you too.
It&rsquo;s a small script which kills a program when you change your Wifi network.
Script:

#!/bin/bash

function log {
    directory=&#34;/Users/&lt;username&gt;/wifi_detect&#34;
    log_dir_exists=true
    if [ ! -d $directory ]; then
        echo &#34;Attempting to create =&gt; $directory&#34;
        mkdir -p $directory
        if [ ! -d $directory ]; then
            echo &#34;Could not create directory. Continue to log to echo.&#34;
            log_dir_exists=false
        fi
    fi
    if $log_dir_exists ; then
        echo &#34;$(date):$1&#34; &gt;&gt; &#34;$directory/log.txt&#34;
    else
        echo &#34;$(date):$1&#34;
    fi
}

function check_program {
    to_kill=&#34;[${1::1}]${1:1}&#34;
    log &#34;Checking if $to_kill really quit.&#34;
    ps=$(ps aux |grep &#34;$to_kill&#34;)
    log &#34;ps =&gt; $ps&#34;
    if [ -z &#34;$ps&#34; ]; then
	# 0 - True
        return
    else
	# 1 - False
        return 1
    fi
}

function kill_program {
    log &#34;Killing program&#34;
    `pkill -f &#34;$1&#34;`
    sleep 1
    if ! check_program $1 ; then
	log &#34;$1 Did not quit!&#34;
    else
	log &#34;$1 quit successfully&#34;
    fi
}

wifi_name=$(networksetup -getairportnetwork en0 |awk -F&#34;: &#34; &#39;{print $2}&#39;)
log &#34;Wifi name: $wifi_name&#34;
if [ &#34;$wifi_name&#34; = &#34;&lt;wifi_name&gt;&#34; ]; then
    log &#34;On corporate network... Killing Program&#34;
    kill_program &#34;&lt;programname&gt;&#34;
elif [ &#34;$wifi_name&#34; = &#34;&lt;home_wifi_name&gt;&#34; ]; then
    # Kill &lt;program&gt; if enabled and if on &lt;home_wifi&gt; and if Tunnelblick is running.
    log &#34;Not on corporate network... Killing &lt;program&gt; if Tunnelblick is active.&#34;
    if ! check_program &#34;Tunnelblick&#34; ; then
	log &#34;Tunnelblick is active. Killing &lt;program&gt;&#34;
	kill_program &#34;&lt;program&gt;&#34;
    else
	log &#34;All good... Happy coding.&#34;
    fi
else
    log &#34;No known Network...&#34;
fi
Now, the trick is, on OSX to only trigger this when your network changes. For this, you can have a &rsquo;launchd&rsquo; daemon, which is configured to watch three files which relate to a network being changed.">
<meta name="author" content="hannibal">
<link rel="canonical" href="https://skarlso.github.io/2015/10/26/kill-a-program-on-connecting-to-a-specific-wifi-osx/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://skarlso.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://skarlso.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://skarlso.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://skarlso.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://skarlso.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://skarlso.github.io/2015/10/26/kill-a-program-on-connecting-to-a-specific-wifi-osx/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Kill a Program on Connecting to a specific WiFi – OSX">
<meta property="og:description" content="Hi folks.
If you have the tendency, like me, to forget that you are on the corporate VPN, or leave a certain software open when you bring your laptop to work, this might be helpful to you too.
It&rsquo;s a small script which kills a program when you change your Wifi network.
Script:

#!/bin/bash

function log {
    directory=&#34;/Users/&lt;username&gt;/wifi_detect&#34;
    log_dir_exists=true
    if [ ! -d $directory ]; then
        echo &#34;Attempting to create =&gt; $directory&#34;
        mkdir -p $directory
        if [ ! -d $directory ]; then
            echo &#34;Could not create directory. Continue to log to echo.&#34;
            log_dir_exists=false
        fi
    fi
    if $log_dir_exists ; then
        echo &#34;$(date):$1&#34; &gt;&gt; &#34;$directory/log.txt&#34;
    else
        echo &#34;$(date):$1&#34;
    fi
}

function check_program {
    to_kill=&#34;[${1::1}]${1:1}&#34;
    log &#34;Checking if $to_kill really quit.&#34;
    ps=$(ps aux |grep &#34;$to_kill&#34;)
    log &#34;ps =&gt; $ps&#34;
    if [ -z &#34;$ps&#34; ]; then
	# 0 - True
        return
    else
	# 1 - False
        return 1
    fi
}

function kill_program {
    log &#34;Killing program&#34;
    `pkill -f &#34;$1&#34;`
    sleep 1
    if ! check_program $1 ; then
	log &#34;$1 Did not quit!&#34;
    else
	log &#34;$1 quit successfully&#34;
    fi
}

wifi_name=$(networksetup -getairportnetwork en0 |awk -F&#34;: &#34; &#39;{print $2}&#39;)
log &#34;Wifi name: $wifi_name&#34;
if [ &#34;$wifi_name&#34; = &#34;&lt;wifi_name&gt;&#34; ]; then
    log &#34;On corporate network... Killing Program&#34;
    kill_program &#34;&lt;programname&gt;&#34;
elif [ &#34;$wifi_name&#34; = &#34;&lt;home_wifi_name&gt;&#34; ]; then
    # Kill &lt;program&gt; if enabled and if on &lt;home_wifi&gt; and if Tunnelblick is running.
    log &#34;Not on corporate network... Killing &lt;program&gt; if Tunnelblick is active.&#34;
    if ! check_program &#34;Tunnelblick&#34; ; then
	log &#34;Tunnelblick is active. Killing &lt;program&gt;&#34;
	kill_program &#34;&lt;program&gt;&#34;
    else
	log &#34;All good... Happy coding.&#34;
    fi
else
    log &#34;No known Network...&#34;
fi
Now, the trick is, on OSX to only trigger this when your network changes. For this, you can have a &rsquo;launchd&rsquo; daemon, which is configured to watch three files which relate to a network being changed.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://skarlso.github.io/2015/10/26/kill-a-program-on-connecting-to-a-specific-wifi-osx/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2015-10-26T00:00:00+00:00">
<meta property="article:modified_time" content="2015-10-26T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kill a Program on Connecting to a specific WiFi – OSX">
<meta name="twitter:description" content="Hi folks.
If you have the tendency, like me, to forget that you are on the corporate VPN, or leave a certain software open when you bring your laptop to work, this might be helpful to you too.
It&rsquo;s a small script which kills a program when you change your Wifi network.
Script:

#!/bin/bash

function log {
    directory=&#34;/Users/&lt;username&gt;/wifi_detect&#34;
    log_dir_exists=true
    if [ ! -d $directory ]; then
        echo &#34;Attempting to create =&gt; $directory&#34;
        mkdir -p $directory
        if [ ! -d $directory ]; then
            echo &#34;Could not create directory. Continue to log to echo.&#34;
            log_dir_exists=false
        fi
    fi
    if $log_dir_exists ; then
        echo &#34;$(date):$1&#34; &gt;&gt; &#34;$directory/log.txt&#34;
    else
        echo &#34;$(date):$1&#34;
    fi
}

function check_program {
    to_kill=&#34;[${1::1}]${1:1}&#34;
    log &#34;Checking if $to_kill really quit.&#34;
    ps=$(ps aux |grep &#34;$to_kill&#34;)
    log &#34;ps =&gt; $ps&#34;
    if [ -z &#34;$ps&#34; ]; then
	# 0 - True
        return
    else
	# 1 - False
        return 1
    fi
}

function kill_program {
    log &#34;Killing program&#34;
    `pkill -f &#34;$1&#34;`
    sleep 1
    if ! check_program $1 ; then
	log &#34;$1 Did not quit!&#34;
    else
	log &#34;$1 quit successfully&#34;
    fi
}

wifi_name=$(networksetup -getairportnetwork en0 |awk -F&#34;: &#34; &#39;{print $2}&#39;)
log &#34;Wifi name: $wifi_name&#34;
if [ &#34;$wifi_name&#34; = &#34;&lt;wifi_name&gt;&#34; ]; then
    log &#34;On corporate network... Killing Program&#34;
    kill_program &#34;&lt;programname&gt;&#34;
elif [ &#34;$wifi_name&#34; = &#34;&lt;home_wifi_name&gt;&#34; ]; then
    # Kill &lt;program&gt; if enabled and if on &lt;home_wifi&gt; and if Tunnelblick is running.
    log &#34;Not on corporate network... Killing &lt;program&gt; if Tunnelblick is active.&#34;
    if ! check_program &#34;Tunnelblick&#34; ; then
	log &#34;Tunnelblick is active. Killing &lt;program&gt;&#34;
	kill_program &#34;&lt;program&gt;&#34;
    else
	log &#34;All good... Happy coding.&#34;
    fi
else
    log &#34;No known Network...&#34;
fi
Now, the trick is, on OSX to only trigger this when your network changes. For this, you can have a &rsquo;launchd&rsquo; daemon, which is configured to watch three files which relate to a network being changed.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://skarlso.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Kill a Program on Connecting to a specific WiFi – OSX",
      "item": "https://skarlso.github.io/2015/10/26/kill-a-program-on-connecting-to-a-specific-wifi-osx/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Kill a Program on Connecting to a specific WiFi – OSX",
  "name": "Kill a Program on Connecting to a specific WiFi – OSX",
  "description": "Hi folks.\nIf you have the tendency, like me, to forget that you are on the corporate VPN, or leave a certain software open when you bring your laptop to work, this might be helpful to you too.\nIt\u0026rsquo;s a small script which kills a program when you change your Wifi network.\nScript:\n#!/bin/bash function log { directory=\u0026#34;/Users/\u0026lt;username\u0026gt;/wifi_detect\u0026#34; log_dir_exists=true if [ ! -d $directory ]; then echo \u0026#34;Attempting to create =\u0026gt; $directory\u0026#34; mkdir -p $directory if [ ! -d $directory ]; then echo \u0026#34;Could not create directory. Continue to log to echo.\u0026#34; log_dir_exists=false fi fi if $log_dir_exists ; then echo \u0026#34;$(date):$1\u0026#34; \u0026gt;\u0026gt; \u0026#34;$directory/log.txt\u0026#34; else echo \u0026#34;$(date):$1\u0026#34; fi } function check_program { to_kill=\u0026#34;[${1::1}]${1:1}\u0026#34; log \u0026#34;Checking if $to_kill really quit.\u0026#34; ps=$(ps aux |grep \u0026#34;$to_kill\u0026#34;) log \u0026#34;ps =\u0026gt; $ps\u0026#34; if [ -z \u0026#34;$ps\u0026#34; ]; then # 0 - True return else # 1 - False return 1 fi } function kill_program { log \u0026#34;Killing program\u0026#34; `pkill -f \u0026#34;$1\u0026#34;` sleep 1 if ! check_program $1 ; then log \u0026#34;$1 Did not quit!\u0026#34; else log \u0026#34;$1 quit successfully\u0026#34; fi } wifi_name=$(networksetup -getairportnetwork en0 |awk -F\u0026#34;: \u0026#34; \u0026#39;{print $2}\u0026#39;) log \u0026#34;Wifi name: $wifi_name\u0026#34; if [ \u0026#34;$wifi_name\u0026#34; = \u0026#34;\u0026lt;wifi_name\u0026gt;\u0026#34; ]; then log \u0026#34;On corporate network... Killing Program\u0026#34; kill_program \u0026#34;\u0026lt;programname\u0026gt;\u0026#34; elif [ \u0026#34;$wifi_name\u0026#34; = \u0026#34;\u0026lt;home_wifi_name\u0026gt;\u0026#34; ]; then # Kill \u0026lt;program\u0026gt; if enabled and if on \u0026lt;home_wifi\u0026gt; and if Tunnelblick is running. log \u0026#34;Not on corporate network... Killing \u0026lt;program\u0026gt; if Tunnelblick is active.\u0026#34; if ! check_program \u0026#34;Tunnelblick\u0026#34; ; then log \u0026#34;Tunnelblick is active. Killing \u0026lt;program\u0026gt;\u0026#34; kill_program \u0026#34;\u0026lt;program\u0026gt;\u0026#34; else log \u0026#34;All good... Happy coding.\u0026#34; fi else log \u0026#34;No known Network...\u0026#34; fi Now, the trick is, on OSX to only trigger this when your network changes. For this, you can have a \u0026rsquo;launchd\u0026rsquo; daemon, which is configured to watch three files which relate to a network being changed.\n",
  "keywords": [
    "launchd", "osx"
  ],
  "articleBody": "Hi folks.\nIf you have the tendency, like me, to forget that you are on the corporate VPN, or leave a certain software open when you bring your laptop to work, this might be helpful to you too.\nIt’s a small script which kills a program when you change your Wifi network.\nScript:\n#!/bin/bash function log { directory=\"/Users//wifi_detect\" log_dir_exists=true if [ ! -d $directory ]; then echo \"Attempting to create =\u003e $directory\" mkdir -p $directory if [ ! -d $directory ]; then echo \"Could not create directory. Continue to log to echo.\" log_dir_exists=false fi fi if $log_dir_exists ; then echo \"$(date):$1\" \u003e\u003e \"$directory/log.txt\" else echo \"$(date):$1\" fi } function check_program { to_kill=\"[${1::1}]${1:1}\" log \"Checking if $to_kill really quit.\" ps=$(ps aux |grep \"$to_kill\") log \"ps =\u003e $ps\" if [ -z \"$ps\" ]; then # 0 - True return else # 1 - False return 1 fi } function kill_program { log \"Killing program\" `pkill -f \"$1\"` sleep 1 if ! check_program $1 ; then log \"$1 Did not quit!\" else log \"$1 quit successfully\" fi } wifi_name=$(networksetup -getairportnetwork en0 |awk -F\": \" '{print $2}') log \"Wifi name: $wifi_name\" if [ \"$wifi_name\" = \"\" ]; then log \"On corporate network... Killing Program\" kill_program \"\" elif [ \"$wifi_name\" = \"\" ]; then # Kill if enabled and if on and if Tunnelblick is running. log \"Not on corporate network... Killing if Tunnelblick is active.\" if ! check_program \"Tunnelblick\" ; then log \"Tunnelblick is active. Killing \" kill_program \"\" else log \"All good... Happy coding.\" fi else log \"No known Network...\" fi Now, the trick is, on OSX to only trigger this when your network changes. For this, you can have a ’launchd’ daemon, which is configured to watch three files which relate to a network being changed.\nThe script sits under your ~/Library/LaunchAgents folder. Create something like, com.username.checknetwork.plist.\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003c!DOCTYPE plist PUBLIC \"-//Apple Computer//DTD PLIST 1.0//EN\" \\ \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"\u003e ",
  "wordCount" : "362",
  "inLanguage": "en",
  "datePublished": "2015-10-26T00:00:00Z",
  "dateModified": "2015-10-26T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "hannibal"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://skarlso.github.io/2015/10/26/kill-a-program-on-connecting-to-a-specific-wifi-osx/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ramblings of a cloud engineer",
    "logo": {
      "@type": "ImageObject",
      "url": "https://skarlso.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://skarlso.github.io/" accesskey="h" title="Ramblings of a cloud engineer (Alt + H)">Ramblings of a cloud engineer</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://skarlso.github.io/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://skarlso.github.io/search/" title="Search">
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://skarlso.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://skarlso.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://skarlso.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://skarlso.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Kill a Program on Connecting to a specific WiFi – OSX
    </h1>
    <div class="post-meta"><span title='2015-10-26 00:00:00 +0000 UTC'>October 26, 2015</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;hannibal

</div>
  </header> 

  <div class="post-content"><p>Hi folks.</p>
<p>If you have the tendency, like me, to forget that you are on the corporate VPN, or leave a certain software open when you bring your laptop to work, this might be helpful to you too.</p>
<p>It&rsquo;s a small script which kills a program when you change your Wifi network.</p>
<p>Script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> log <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    directory<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Users/&lt;username&gt;/wifi_detect&#34;</span>
</span></span><span style="display:flex;"><span>    log_dir_exists<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> ! -d $directory <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;Attempting to create =&gt; </span>$directory<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        mkdir -p $directory
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> ! -d $directory <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>            echo <span style="color:#e6db74">&#34;Could not create directory. Continue to log to echo.&#34;</span>
</span></span><span style="display:flex;"><span>            log_dir_exists<span style="color:#f92672">=</span>false
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> $log_dir_exists ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>date<span style="color:#66d9ef">)</span><span style="color:#e6db74">:</span>$1<span style="color:#e6db74">&#34;</span> &gt;&gt; <span style="color:#e6db74">&#34;</span>$directory<span style="color:#e6db74">/log.txt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>date<span style="color:#66d9ef">)</span><span style="color:#e6db74">:</span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> check_program <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    to_kill<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[</span><span style="color:#e6db74">${</span>1::1<span style="color:#e6db74">}</span><span style="color:#e6db74">]</span><span style="color:#e6db74">${</span>1:1<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;Checking if </span>$to_kill<span style="color:#e6db74"> really quit.&#34;</span>
</span></span><span style="display:flex;"><span>    ps<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>ps aux |grep <span style="color:#e6db74">&#34;</span>$to_kill<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;ps =&gt; </span>$ps<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$ps<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 0 - True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 1 - False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> kill_program <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;Killing program&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">`</span>pkill -f <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>    sleep <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ! check_program $1 ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>	log <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74"> Did not quit!&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>	log <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74"> quit successfully&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wifi_name<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>networksetup -getairportnetwork en0 |awk -F<span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#e6db74">&#39;{print $2}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>log <span style="color:#e6db74">&#34;Wifi name: </span>$wifi_name<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$wifi_name<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;wifi_name&gt;&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;On corporate network... Killing Program&#34;</span>
</span></span><span style="display:flex;"><span>    kill_program <span style="color:#e6db74">&#34;&lt;programname&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$wifi_name<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;home_wifi_name&gt;&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Kill &lt;program&gt; if enabled and if on &lt;home_wifi&gt; and if Tunnelblick is running.</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;Not on corporate network... Killing &lt;program&gt; if Tunnelblick is active.&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ! check_program <span style="color:#e6db74">&#34;Tunnelblick&#34;</span> ; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>	log <span style="color:#e6db74">&#34;Tunnelblick is active. Killing &lt;program&gt;&#34;</span>
</span></span><span style="display:flex;"><span>	kill_program <span style="color:#e6db74">&#34;&lt;program&gt;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>	log <span style="color:#e6db74">&#34;All good... Happy coding.&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    log <span style="color:#e6db74">&#34;No known Network...&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span></code></pre></div><p>Now, the trick is, on OSX to only trigger this when your network changes. For this, you can have a &rsquo;launchd&rsquo; daemon, which is configured to watch three files which relate to a network being changed.</p>
<p>The script sits under your ~/Library/LaunchAgents folder. Create something like, com.username.checknetwork.plist.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE plist PUBLIC &#34;-//Apple Computer//DTD PLIST 1.0//EN&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;plist</span> <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;1.0&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dict&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;key&gt;</span>Label<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;string&gt;</span>ifup.ddns<span style="color:#f92672">&lt;/string&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;key&gt;</span>LowPriorityIO<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;true/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;key&gt;</span>ProgramArguments<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;array&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;string&gt;</span>/Users/username/scripts/ddns-update.sh<span style="color:#f92672">&lt;/string&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/array&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;key&gt;</span>WatchPaths<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;array&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;string&gt;</span>/etc/resolv.conf<span style="color:#f92672">&lt;/string&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;string&gt;</span>/Library/Preferences/SystemConfiguration/NetworkInterfaces.plist<span style="color:#f92672">&lt;/string&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;string&gt;</span>/Library/Preferences/SystemConfiguration/com.apple.airport.preferences.plist<span style="color:#f92672">&lt;/string&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/array&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;key&gt;</span>RunAtLoad<span style="color:#f92672">&lt;/key&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;true/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dict&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/plist&gt;</span>
</span></span></code></pre></div><p>Now, when you change your network, to whatever your corporate network is, you&rsquo;ll kill Sublime.</p>
<p>Hope this helps somebody.</p>
<p>Cheers,</p>
<p>Gergely.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://skarlso.github.io/tags/launchd/">Launchd</a></li>
      <li><a href="https://skarlso.github.io/tags/osx/">Osx</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://skarlso.github.io/2015/11/09/go-progress-quest/">
    <span class="title">« Prev</span>
    <br>
    <span>Go Progress Quest</span>
  </a>
  <a class="next" href="https://skarlso.github.io/2015/10/15/circular-buffer-in-go/">
    <span class="title">Next »</span>
    <br>
    <span>Circular buffer in Go</span>
  </a>
</nav>

  </footer><div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hannibalDisqus" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://skarlso.github.io/">Ramblings of a cloud engineer</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
