<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Jenkins Job DSL and Groovy goodness | Ramblings of a cloud engineer</title>
<meta name="keywords" content="jenkins">
<meta name="description" content="Hi Folks.
Ever used Job DSL plugin for Jenkins? What is that you say? Well, it&rsquo;s TEH most awesome plug-in for Jenkins to have, because you can CODE your job configuration and put it under source control.
Today, however, I&rsquo;m not going to write about that because the tutorials on Jenkins JOB DSL are very extensive and very well done. Anyone can pick them up.
Today, I would like to write about a part of it which is even more interesting.">
<meta name="author" content="hannibal">
<link rel="canonical" href="https://skarlso.github.io/2015/10/15/jenkins-job-dsl-and-groovy-goodness/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css" integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe&#43;FVUFzPh7U=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://skarlso.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://skarlso.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://skarlso.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://skarlso.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://skarlso.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Jenkins Job DSL and Groovy goodness" />
<meta property="og:description" content="Hi Folks.
Ever used Job DSL plugin for Jenkins? What is that you say? Well, it&rsquo;s TEH most awesome plug-in for Jenkins to have, because you can CODE your job configuration and put it under source control.
Today, however, I&rsquo;m not going to write about that because the tutorials on Jenkins JOB DSL are very extensive and very well done. Anyone can pick them up.
Today, I would like to write about a part of it which is even more interesting." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://skarlso.github.io/2015/10/15/jenkins-job-dsl-and-groovy-goodness/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-10-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2015-10-15T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Jenkins Job DSL and Groovy goodness"/>
<meta name="twitter:description" content="Hi Folks.
Ever used Job DSL plugin for Jenkins? What is that you say? Well, it&rsquo;s TEH most awesome plug-in for Jenkins to have, because you can CODE your job configuration and put it under source control.
Today, however, I&rsquo;m not going to write about that because the tutorials on Jenkins JOB DSL are very extensive and very well done. Anyone can pick them up.
Today, I would like to write about a part of it which is even more interesting."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://skarlso.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Jenkins Job DSL and Groovy goodness",
      "item": "https://skarlso.github.io/2015/10/15/jenkins-job-dsl-and-groovy-goodness/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Jenkins Job DSL and Groovy goodness",
  "name": "Jenkins Job DSL and Groovy goodness",
  "description": "Hi Folks.\nEver used Job DSL plugin for Jenkins? What is that you say? Well, it\u0026rsquo;s TEH most awesome plug-in for Jenkins to have, because you can CODE your job configuration and put it under source control.\nToday, however, I\u0026rsquo;m not going to write about that because the tutorials on Jenkins JOB DSL are very extensive and very well done. Anyone can pick them up.\nToday, I would like to write about a part of it which is even more interesting.",
  "keywords": [
    "jenkins"
  ],
  "articleBody": "Hi Folks.\nEver used Job DSL plugin for Jenkins? What is that you say? Well, it’s TEH most awesome plug-in for Jenkins to have, because you can CODE your job configuration and put it under source control.\nToday, however, I’m not going to write about that because the tutorials on Jenkins JOB DSL are very extensive and very well done. Anyone can pick them up.\nToday, I would like to write about a part of it which is even more interesting. And that is, extracting re-occurring parts in your job configurations.\nIf you have jobs, which have a common part that is repeated everywhere, you usually have an urge to extracted that into one place, lest it changes and you have to go an apply the change everywhere. That’s not very efficient. But how do you do that in something which looks like a JSON descriptor?\nFret not, it is just Groovy. And being just groovy, you can use Groovy to implement parts of the job description and then apply that implementation to the job in the DSL.\nSuppose you have an email which you send after every job for which the DSL looks like this:\njob('MyTestJob') { description 'GENERATED - do not modify' label('machine_label') logRotator(30, -1, -1, 5) parameters { stringParam('somestringparam', 'default_valye', 'Description') } wrappers { timeout { noActivity(600) abortBuild() failBuild() writeDescription('Build failed due to timeout after {0} minutes') } } deliveryPipelineConfiguration(\"Main\", \"MyTestJob\") wrappers { preBuildCleanup { deleteDirectories() } timestamps() } triggers { cron('H 12 * * 1,2') } steps { batchFile(readFileFromWorkspace('relative/path/to/file')) } publishers { wsCleanup() extendedEmail('email@address.com', '$DEFAULT_SUBJECT', '$DEFAULT_CONTENT') { configure { node -\u003e node / presendScript \u003c\u003c readFileFromWorkspace('email_templates/emailtemplate.groovy') node / replyTo \u003c\u003c '$DEFAULT_REPLYTO' node / contentType \u003c\u003c 'default' } trigger(triggerName: 'StillUnstable', subject: '$DEFAULT_SUBJECT', body: '$DEFAULT_CONTENT', replyTo: '$DEFAULT_REPLYTO', sendToDevelopers: true, sendToRecipientList: true) trigger(triggerName: 'Fixed', subject: '$DEFAULT_SUBJECT', body: '$DEFAULT_CONTENT', replyTo: '$DEFAULT_REPLYTO', sendToDevelopers: true, sendToRecipientList: true) trigger(triggerName: 'Failure', subject: '$DEFAULT_SUBJECT', body: '$DEFAULT_CONTENT', replyTo: '$DEFAULT_REPLYTO', sendToDevelopers: true, sendToRecipientList: true) } } } Now, that big chunk of email setting is copied into a bunch of files, which is pretty ugly. And once you try to change it, you’ll have to change it everywhere. Also, the interesting bits here are those readFileFromWorkspace parts. Those allow us to export even larger chunks of the script into external files. Now, because the slave might be located somewhere else, you should not use new File(‘file’).text in your job DSL. readFileFromWorkspace in the background does that, but applies correct way to the PATH it looks on for the file specified.\nLet’s put this into a groovy script, shall we? Create a utilities folder where the DSL is and create a groovy file in it like this one:\npackage utilities public class JobCommonTemplate { public static void addEmailTemplate(def job, def dslFactory) { String emailScript = dslFactory.readFileFromWorkspace(\"email_template/EmailTemplate.groovy\") job.with { publishers { wsCleanup() extendedEmail('email@address.com', '$DEFAULT_SUBJECT', '$DEFAULT_CONTENT') { configure { node -\u003e node / presendScript \u003c\u003c emailScript node / replyTo \u003c\u003c '$DEFAULT_REPLYTO' node / contentType \u003c\u003c 'default' } trigger(triggerName: 'StillUnstable', subject: '$DEFAULT_SUBJECT', body: '$DEFAULT_CONTENT', replyTo: '$DEFAULT_REPLYTO', sendToDevelopers: true, sendToRecipientList: true) trigger(triggerName: 'Fixed', subject: '$DEFAULT_SUBJECT', body: '$DEFAULT_CONTENT', replyTo: '$DEFAULT_REPLYTO', sendToDevelopers: true, sendToRecipientList: true) trigger(triggerName: 'Failure', subject: '$DEFAULT_SUBJECT', body: '$DEFAULT_CONTENT', replyTo: '$DEFAULT_REPLYTO', sendToDevelopers: true, sendToRecipientList: true) } } } } } The function addEmailTemplate gets two parameters. A job, which is an implementation of a Job, and a dslFactory which is a DslFactory. That factory is an interface which defines our readFileFromWorkspace. Where do we get the implementation from then? That will be from the Job. Let’s alter our job to apply this Groovy script.\nimport utilities.JobCommonTemplate def myJob = job('MyTestJob') { description 'GENERATED - do not modify' label('machine_label') logRotator(30, -1, -1, 5) parameters { stringParam('somestringparam', 'default_valye', 'Description') } wrappers { timeout { noActivity(600) abortBuild() failBuild() writeDescription('Build failed due to timeout after {0} minutes') } } deliveryPipelineConfiguration(\"Main\", \"MyTestJob\") wrappers { preBuildCleanup { deleteDirectories() } timestamps() } triggers { cron('H 12 * * 1,2') } steps { batchFile(readFileFromWorkspace('relative/path/to/file')) } } JobCommonTemplate.addEmailTemplate(myJob, this) Notice three things here.\n#1 =\u003e import. We import the script from utilities folder which we created and placed the script into it.\n#2 =\u003e def myJob. We create a variable which will contain our job’s description.\n#3 =\u003e this. ’this’ will be the DslFactory. That’s where we get our readFileFromWorkspace implementation.\nAnd that’s it. We have extracted a part of our job which is re-occurring and we found our implementation for our readFileFromWorkspace. DslFactory has most of the things which you need in a job description, would you want to expand on this and extract other bits and pieces.\nHave fun, and happy coding!\nAs always,\nThanks for reading!\nGergely.\n",
  "wordCount" : "759",
  "inLanguage": "en",
  "datePublished": "2015-10-15T00:00:00Z",
  "dateModified": "2015-10-15T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "hannibal"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://skarlso.github.io/2015/10/15/jenkins-job-dsl-and-groovy-goodness/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ramblings of a cloud engineer",
    "logo": {
      "@type": "ImageObject",
      "url": "https://skarlso.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://skarlso.github.io" accesskey="h" title="Ramblings of a cloud engineer (Alt + H)">Ramblings of a cloud engineer</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://skarlso.github.io/posts/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://skarlso.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://skarlso.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Jenkins Job DSL and Groovy goodness
    </h1>
    <div class="post-meta"><span title='2015-10-15 00:00:00 +0000 UTC'>October 15, 2015</span>&nbsp;·&nbsp;hannibal

</div>
  </header> 
  <div class="post-content"><p>Hi Folks.</p>
<p>Ever used <a href="https://wiki.jenkins-ci.org/display/JENKINS/Job+DSL+Plugin" target="_blank">Job DSL plugin</a> for Jenkins? What is that you say? Well, it&rsquo;s TEH most awesome plug-in for Jenkins to have, because you can CODE your job configuration and put it under source control.</p>
<p>Today, however, I&rsquo;m not going to write about that because the tutorials on Jenkins JOB DSL are very extensive and very well done. Anyone can pick them up.</p>
<p>Today, I would like to write about a part of it which is even more interesting. And that is, extracting re-occurring parts in your job configurations.</p>
<p>If you have jobs, which have a common part that is repeated everywhere, you usually have an urge to extracted that into one place, lest it changes and you have to go an apply the change everywhere. That&rsquo;s not very efficient. But how do you do that in something which looks like a JSON descriptor?</p>
<p>Fret not, it is just Groovy. And being just groovy, you can use Groovy to implement parts of the job description and then apply that implementation to the job in the DSL.</p>
<p>Suppose you have an email which you send after every job for which the DSL looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>job<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;MyTestJob&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    description <span style="color:#e6db74">&#39;&lt;strong&gt;GENERATED - do not modify&lt;/strong&gt;&#39;</span>
</span></span><span style="display:flex;"><span>    label<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;machine_label&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    logRotator<span style="color:#f92672">(</span><span style="color:#ae81ff">30</span><span style="color:#f92672">,</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    parameters <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        stringParam<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;somestringparam&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;default_valye&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;Description&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    wrappers <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        timeout <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            noActivity<span style="color:#f92672">(</span><span style="color:#ae81ff">600</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>            abortBuild<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>            failBuild<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>            writeDescription<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Build failed due to timeout after {0} minutes&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    deliveryPipelineConfiguration<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Main&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;MyTestJob&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    wrappers <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        preBuildCleanup <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            deleteDirectories<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        timestamps<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    triggers <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        cron<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;H 12 * * 1,2&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        batchFile<span style="color:#f92672">(</span>readFileFromWorkspace<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;relative/path/to/file&#39;</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            publishers <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                wsCleanup<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                extendedEmail<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;email@address.com&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;$DEFAULT_SUBJECT&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;$DEFAULT_CONTENT&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    configure <span style="color:#f92672">{</span> node <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>                        node <span style="color:#e6db74">/ presendScript &lt;&lt; readFileFromWorkspace(&#39;email_templates/</span>emailtemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">groovy</span><span style="color:#e6db74">&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        node / replyTo &lt;&lt; &#39;</span>$DEFAULT_REPLYTO<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        node / contentType &lt;&lt; &#39;</span><span style="color:#66d9ef">default</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    trigger(triggerName: &#39;</span>StillUnstable<span style="color:#e6db74">&#39;, subject: &#39;</span>$DEFAULT_SUBJECT<span style="color:#e6db74">&#39;, body: &#39;</span>$DEFAULT_CONTENT<span style="color:#e6db74">&#39;, replyTo: &#39;</span>$DEFAULT_REPLYTO<span style="color:#e6db74">&#39;, sendToDevelopers: true, sendToRecipientList: true)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    trigger(triggerName: &#39;</span>Fixed<span style="color:#e6db74">&#39;, subject: &#39;</span>$DEFAULT_SUBJECT<span style="color:#e6db74">&#39;, body: &#39;</span>$DEFAULT_CONTENT<span style="color:#e6db74">&#39;, replyTo: &#39;</span>$DEFAULT_REPLYTO<span style="color:#e6db74">&#39;, sendToDevelopers: true, sendToRecipientList: true)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    trigger(triggerName: &#39;</span>Failure<span style="color:#e6db74">&#39;, subject: &#39;</span>$DEFAULT_SUBJECT<span style="color:#e6db74">&#39;, body: &#39;</span>$DEFAULT_CONTENT<span style="color:#e6db74">&#39;, replyTo: &#39;</span>$DEFAULT_REPLYTO<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span> sendToDevelopers: <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> sendToRecipientList: <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Now, that big chunk of email setting is copied into a bunch of files, which is pretty ugly. And once you try to change it, you&rsquo;ll have to change it everywhere. Also, the interesting bits here are those readFileFromWorkspace parts. Those allow us to export even larger chunks of the script into external files. Now, because the slave might be located somewhere else, you should not use new File(&lsquo;file&rsquo;).text in your job DSL. readFileFromWorkspace in the background does that, but applies correct way to the PATH it looks on for the file specified.</p>
<p>Let&rsquo;s put this into a groovy script, shall we? Create a utilities folder where the DSL is and create a groovy file in it like this one:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> utilities
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">JobCommonTemplate</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addEmailTemplate</span><span style="color:#f92672">(</span><span style="color:#66d9ef">def</span> job<span style="color:#f92672">,</span> <span style="color:#66d9ef">def</span> dslFactory<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        String emailScript <span style="color:#f92672">=</span> dslFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">readFileFromWorkspace</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;email_template/EmailTemplate.groovy&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        job<span style="color:#f92672">.</span><span style="color:#a6e22e">with</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            publishers <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                wsCleanup<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                extendedEmail<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;email@address.com&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;$DEFAULT_SUBJECT&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;$DEFAULT_CONTENT&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    configure <span style="color:#f92672">{</span> node <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>                        node <span style="color:#e6db74">/ presendScript &lt;&lt; emailScript
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        node /</span> replyTo <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#39;$DEFAULT_REPLYTO&#39;</span>
</span></span><span style="display:flex;"><span>                        node <span style="color:#f92672">/</span> contentType <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#39;default&#39;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                    trigger<span style="color:#f92672">(</span>triggerName: <span style="color:#e6db74">&#39;StillUnstable&#39;</span><span style="color:#f92672">,</span> subject: <span style="color:#e6db74">&#39;$DEFAULT_SUBJECT&#39;</span><span style="color:#f92672">,</span> body: <span style="color:#e6db74">&#39;$DEFAULT_CONTENT&#39;</span><span style="color:#f92672">,</span> replyTo: <span style="color:#e6db74">&#39;$DEFAULT_REPLYTO&#39;</span><span style="color:#f92672">,</span> sendToDevelopers: <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> sendToRecipientList: <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                    trigger<span style="color:#f92672">(</span>triggerName: <span style="color:#e6db74">&#39;Fixed&#39;</span><span style="color:#f92672">,</span> subject: <span style="color:#e6db74">&#39;$DEFAULT_SUBJECT&#39;</span><span style="color:#f92672">,</span> body: <span style="color:#e6db74">&#39;$DEFAULT_CONTENT&#39;</span><span style="color:#f92672">,</span> replyTo: <span style="color:#e6db74">&#39;$DEFAULT_REPLYTO&#39;</span><span style="color:#f92672">,</span> sendToDevelopers: <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> sendToRecipientList: <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                    trigger<span style="color:#f92672">(</span>triggerName: <span style="color:#e6db74">&#39;Failure&#39;</span><span style="color:#f92672">,</span> subject: <span style="color:#e6db74">&#39;$DEFAULT_SUBJECT&#39;</span><span style="color:#f92672">,</span> body: <span style="color:#e6db74">&#39;$DEFAULT_CONTENT&#39;</span><span style="color:#f92672">,</span> replyTo: <span style="color:#e6db74">&#39;$DEFAULT_REPLYTO&#39;</span><span style="color:#f92672">,</span> sendToDevelopers: <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> sendToRecipientList: <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>The function addEmailTemplate gets two parameters. A job, which is an implementation of a Job, and a dslFactory which is a DslFactory. That factory is an interface which defines our readFileFromWorkspace. Where do we get the implementation from then? That will be from the Job. Let&rsquo;s alter our job to apply this Groovy script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> utilities.JobCommonTemplate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> myJob <span style="color:#f92672">=</span> job<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;MyTestJob&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    description <span style="color:#e6db74">&#39;&lt;strong&gt;GENERATED - do not modify&lt;/strong&gt;&#39;</span>
</span></span><span style="display:flex;"><span>    label<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;machine_label&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    logRotator<span style="color:#f92672">(</span><span style="color:#ae81ff">30</span><span style="color:#f92672">,</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    parameters <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        stringParam<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;somestringparam&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;default_valye&#39;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#39;Description&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    wrappers <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        timeout <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            noActivity<span style="color:#f92672">(</span><span style="color:#ae81ff">600</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>            abortBuild<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>            failBuild<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>            writeDescription<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Build failed due to timeout after {0} minutes&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    deliveryPipelineConfiguration<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Main&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;MyTestJob&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    wrappers <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        preBuildCleanup <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            deleteDirectories<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        timestamps<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    triggers <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        cron<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;H 12 * * 1,2&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    steps <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        batchFile<span style="color:#f92672">(</span>readFileFromWorkspace<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;relative/path/to/file&#39;</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>JobCommonTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">addEmailTemplate</span><span style="color:#f92672">(</span>myJob<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Notice three things here.</p>
<p>#1 =&gt; <strong>import</strong>. We import the script from utilities folder which we created and placed the script into it.</p>
<p>#2 =&gt; <strong>def myJob</strong>. We create a variable which will contain our job&rsquo;s description.</p>
<p>#3 =&gt; <strong>this</strong>. &rsquo;this&rsquo; will be the DslFactory. That&rsquo;s where we get our readFileFromWorkspace implementation.</p>
<p>And that&rsquo;s it. We have extracted a part of our job which is re-occurring and we found our implementation for our readFileFromWorkspace. DslFactory has most of the things which you need in a job description, would you want to expand on this and extract other bits and pieces.</p>
<p>Have fun, and happy coding!</p>
<p>As always,</p>
<p>Thanks for reading!</p>
<p>Gergely.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://skarlso.github.io/tags/jenkins/">jenkins</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://skarlso.github.io">Ramblings of a cloud engineer</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
